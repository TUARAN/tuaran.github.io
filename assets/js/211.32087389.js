(window.webpackJsonp=window.webpackJsonp||[]).push([[211],{711:function(s,n,a){"use strict";a.r(n);var e=a(2),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("持续创作，加速成长！这是我参与「掘金日新计划 · 6 月更文挑战」的第20天，"),a("a",{attrs:{href:"https://juejin.cn/post/7099702781094674468",title:"https://juejin.cn/post/7099702781094674468",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击查看活动详情"),a("OutboundLink")],1)]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("我们前不久写过发布订阅模式：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// 发布者 Publisher\nclass Pub {\n    constructor() {\n        this.deps = [];\n    }\n    addDep(dep) {\n        this.deps.push(dep);\n    }\n    publish(dep) {\n        this.deps.forEach(item => item === dep && item.notify());\n    }\n}\n// 订阅者 Subscriber\nclass Sub {\n    constructor(val) {\n        this.val = val;\n    }\n\n    update(callback) {\n        callback(this.val)\n    }\n}\n\n// 调度中心\nclass Dep {\n    constructor(callback) { // 核心是这个 callback 函数；\n        this.subs = [];\n        this.callback = callback;\n    }\n    addSub(sub) {\n        this.subs.push(sub);\n    }\n    notify() {\n        this.subs.forEach(item => item.update(this.callback));\n    }\n}\n\nlet pub = new Pub() // 实例化一个发布者\n\n// 实例化一个调度中心，传入一个用于处理数据的函数；\nconst dep1 = new Dep((data) =>\n              console.log(\'我是调度中心，我先把消息处理一下，然后发给 ===》》》\', data)) \n\nlet sub1 = new Sub("订阅者1") // 实例化订阅者1\nlet sub2 = new Sub("订阅者2") // 实例化订阅者2\n\npub.addDep(dep) // 发布者绑定调度中心\n\ndep.addSub(sub1) // 调度中心添加订阅者1\ndep.addSub(sub2) // 调度中心添加订阅者2\n\npub.publish(dep) // 发布者把消息推给调度者\n\n// 我是调度中心，我先把消息处理下先 订阅者1\n// 我是调度中心，我先把消息处理下先 订阅者2\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[s._v("但是这样看，似乎有点太复杂了：")]),s._v(" "),a("ul",[a("li",[s._v("发布者需要有两个方法，绑定调度者 Dep，把消息推知给调度者；")]),s._v(" "),a("li",[s._v("调度者也有两个方法，绑定订阅者 Sub，把消息推送给订阅者；")]),s._v(" "),a("li",[s._v("订阅者有一个方法，执行函数；")])]),s._v(" "),a("p",[s._v("这里面最重要的是有一个回调函数，作为调度中心的入参，会传给 Sub 执行；")]),s._v(" "),a("p",[s._v("于是，本篇带来 "),a("strong",[s._v("简化")]),s._v(" 了的思路进行理解：")]),s._v(" "),a("p",[s._v("比方说天气预报这个场景：气象站是需要发布信息的；建筑工地、船舶行业、普通游客是需要这些信息的；")]),s._v(" "),a("p",[s._v("如果我们直接强绑定这个通知关系，即：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("function weatherWarning(weatherStatus){\n\tif(weatherStatus==='warning'){ // 糟糕的天气\n\t\t  buildingsite.stopwork() // 工地停工\n\t\t  ships.mooring()　// 船舶停航\n\t\t  tourists.canceltrip() // 旅游取消\n\t}\n}\n\nweatherWarning(\"warning\") // 发布坏天气通知\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b38a200c038467e84b8aec7aeaf7596~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v(" "),a("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Ffrontend-canteen%2Fuseful-design-patterns-48ac739882a4",title:"https://medium.com/frontend-canteen/useful-design-patterns-48ac739882a4",target:"_blank",rel:"noopener noreferrer"}},[s._v("图片来源"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("这样做，有无毛病？")]),s._v(" "),a("p",[s._v("还得是它俩：有毛病！违背开闭原则、违背单一职责原则；")]),s._v(" "),a("p",[s._v("违背开闭原则：上例中，如果有新的群体需要获取天气信息，要不断修改 weatherWarning 函数；")]),s._v(" "),a("p",[s._v("违背单一职责原则：上例中，任何一个群体代码执行错误，都会影响 weatherWarning 函数体代码的向下执行；")]),s._v(" "),a("p",[s._v("所以，还得改，于是引入：调度中心 Dep，这里叫 EventEmit")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d38924132b094b97a309ef0c74198dac~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v(" "),a("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Ffrontend-canteen%2Fuseful-design-patterns-48ac739882a4",title:"https://medium.com/frontend-canteen/useful-design-patterns-48ac739882a4",target:"_blank",rel:"noopener noreferrer"}},[s._v("图片来源"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("由调度中心来绑定需要信息的群体，即绑定订阅器，然后由调度中心发布信息给订阅者；")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const EventEmit = function() { // 调度中心\n  this.events = {};\n  this.on = function(name, cb) { // 绑定订阅器\n    if (this.events[name]) {\n      this.events[name].push(cb); // 支持同一个订阅器执行多个事情\n    } else {\n      this.events[name] = [cb];\n    }\n  };\n  this.trigger = function(name, ...arg) { // 发送消息\n    if (this.events[name]) {\n      this.events[name].forEach(eventListener => {\n        eventListener(...arg);\n      });\n    }\n  };\n};\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("let weatherEvent = new EventEmit() // 实例化一个调度中心\n\nweatherEvent.on('warning', function () { // 绑定发布通知的关系\n  // buildingsite.stopwork()\n  console.log('buildingsite.stopwork()')\n})\n\nweatherEvent.on('warning', function () { // 绑定发布通知的关系\n  // ships.mooring()\n  console.log('ships.mooring()')\n})\n\nweatherEvent.on('warning', function () { // 绑定发布通知的关系\n  // tourists.canceltrip()\n  console.log('tourists.canceltrip()')\n})\n\nweatherEvent.trigger('warning')  // 发布消息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("当项目中存在一对多的依赖，且每个模块相对独立，可以考虑使用发布订阅模式来重构代码，即由调度中心来绑定、通知。")]),s._v(" "),a("p",[s._v("有工友可能疑问：这个怎么和之前说的【观察者模式】长得那么像？")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Subject{// 被观察者\n    constructor(){\n        this.observers=[]\n    }\n    add(observer){\n        this.observers.push(observer)\n    }\n    notify(weatherStatus){\n        this.observers.forEach(i=>i(weatherStatus))\n    }\n}\n\nlet sub = new Subject()\n\nsub.add((reason)=>{\n\t// buildingsite.stopwork()\n\tconsole.log('工地停工，因为天气：',reason)\n}) \nsub.add((reason)=>{\n\t// ships.stopwork()\n\tconsole.log('船舶停航，因为天气：',reason)\n})\nsub.add((reason)=>{\n\t// tourists.canceltrip()\n\tconsole.log('旅游取消，因为天气：',reason)\n})\n\nsub.notify(\"warning\") // sub 发布消息\n\n// 工地停工，因为天气： warning\n// 船舶停航，因为天气： warning\n// 旅游取消，因为天气： warning\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("p",[s._v("没错，我们可以再简化理解：观察者模式是发布订阅模式的一部分，如果你把被观察者视作调度中心的话呢，这就是发布订阅模式，如果你把订阅中心视作被观察者，那就是观察者模式；两者是可以互相转化的。")]),s._v(" "),a("p",[s._v("观察者模式：A 推给 ob1、ob2、ob3，一对多；")]),s._v(" "),a("p",[s._v("发布订阅模式： A 推给 Dep ，Dep 再推给 ob1、ob2、ob3，一对一，再对多；")]),s._v(" "),a("p",[s._v("发布订阅模式应该是我们前端开发者最常用的设计模式：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("element.addEventListener('click', function(){ \n  //... \n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("hr"),s._v(" "),a("blockquote",[a("p",[s._v("OK，以上便是本篇分享。点赞关注评论，为好文助力👍")]),s._v(" "),a("p",[s._v("我是掘金安东尼 🤠 100 万阅读量人气前端技术博主 💥 INFP 写作人格坚持 1000 日更文 ✍ 关注我，陪你一起度过漫长编程岁月 🌏")])])])}),[],!1,null,null,null);n.default=t.exports}}]);