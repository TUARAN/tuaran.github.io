(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{688:function(e,v,t){"use strict";t.r(v);var s=t(2),r=Object(s.a)({},(function(){var e=this,v=e.$createElement,t=e._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h3",{attrs:{id:"⭐白银回答"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⭐白银回答"}},[e._v("#")]),e._v(" ⭐白银回答")]),e._v(" "),t("blockquote",[t("p",[e._v("scoped 原理？")]),e._v(" "),t("p",[e._v("不就是给那啥加一个特殊标识，然后样式就被"),t("strong",[e._v("唯一标记")]),e._v("，就实现了样式隔离的作用。")])]),e._v(" "),t("h3",{attrs:{id:"⭐⭐铂金回答"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⭐⭐铂金回答"}},[e._v("#")]),e._v(" ⭐⭐铂金回答")]),e._v(" "),t("blockquote",[t("p",[e._v("scoped 原理呀")]),e._v(" "),t("p",[e._v("当 style 标签加上 scoped 属性时，scoped 会在 DOM 结构及 css 样式上加上唯一性的标记 "),t("strong",[e._v("data-v-xxx")]),e._v(" 属性，从而达到样式私有化，不污染全局的作用；")])]),e._v(" "),t("h3",{attrs:{id:"⭐⭐⭐钻石回答"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⭐⭐⭐钻石回答"}},[e._v("#")]),e._v(" ⭐⭐⭐钻石回答")]),e._v(" "),t("blockquote",[t("p",[e._v("嗯！")]),e._v(" "),t("p",[t("strong",[e._v("Scope CSS 的本质是基于 HTML 和 CSS 属性选择器")]),e._v("，即分别给 HTML 标签和 CSS 选择器添加 data-v-xxx；")]),e._v(" "),t("p",[e._v("具体来说，它是 "),t("strong",[e._v("通过 vue-loader 实现")]),e._v(" 的，实现过程大致分 3 步：")]),e._v(" "),t("ol",[t("li",[e._v("首先 vue-loader 会解析 .vue 组件，提取出 template、script、style 对应的代码块；")]),e._v(" "),t("li",[e._v("然后构造组件实例，在组件实例的选项上绑定 ScopedId；")]),e._v(" "),t("li",[e._v("最后对 style 的 CSS 代码进行编译转化，应用 ScopedId 生成选择器的属性；")])])]),e._v(" "),t("h3",{attrs:{id:"⭐⭐⭐⭐大师回答"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⭐⭐⭐⭐大师回答"}},[e._v("#")]),e._v(" ⭐⭐⭐⭐大师回答")]),e._v(" "),t("blockquote",[t("p",[e._v("Vue scoped，原理，涉及到 vue-loader 的处理策略：")]),e._v(" "),t("p",[e._v("一、首先呢，是 "),t("strong",[e._v("VueLoaderPlugin")]),e._v(" 策略：")]),e._v(" "),t("p",[e._v("VueLoaderPlugin 先获取了 webpack 原来的 rules（ 即 "),t("code",[e._v("compiler.option.module.rule")]),e._v(" 的比如 "),t("code",[e._v("test:/.vue$/")]),e._v(" 规则），然后创建了"),t("code",[e._v("pitcher")]),e._v(" 规则，pitcher 中的 "),t("strong",[e._v("pitcher-loader")]),e._v(" 可以通过 "),t("strong",[e._v("resourceQuery")]),e._v(" 识别引入文件的 "),t("strong",[e._v("query")]),e._v(" 带的关键字，进行 "),t("strong",[e._v("loader")]),e._v(" 解析；（pitcher-loader 提供了前置运行和熔断运行的机制）")]),e._v(" "),t("p",[e._v("然后 VueLoaderPlugin 将进行 "),t("code",[e._v("clonedRule")]),e._v("（ 即对 "),t("strong",[e._v("vueRule")]),e._v(" 以外的 rule 进行处理），具体是重写 "),t("strong",[e._v("resource")]),e._v(" 和 "),t("strong",[e._v("resourceQuery")]),e._v("，使得 loader 最终能匹配上文件；")]),e._v(" "),t("p",[e._v("举例：对于 vue+ts 的写法，会在 vue 的 script 标签中加上 "),t("strong",[e._v("lang='ts’")]),e._v("，重写后 "),t("strong",[e._v("fakeresourceQuery")]),e._v(" 文件路径为 xx.vue.ts，然后结合"),t("strong",[e._v("ts-loader")]),e._v(" 的 resource 过滤方法"),t("code",[e._v("/.tsx?$/")]),e._v(" 匹配上文件")]),e._v(" "),t("p",[e._v("然后才来到："),t("code",[e._v("vueRule")]),e._v(" 的 vue-loader 执行阶段；")])]),e._v(" "),t("p",[t("sub",[e._v("这里简单理解：VueLoaderPlugin 就是来处理 rule 的，让 loader 能够和文件匹配。处理顺序："),t("code",[e._v("pitcher")]),e._v(" ⇒ "),t("code",[e._v("clonedRule")]),e._v(" ⇒ "),t("code",[e._v("vueRule")])])]),e._v(" "),t("blockquote",[t("p",[e._v("二、  有了上面的匹配文件，接着来到了 "),t("strong",[e._v("vue-loader")]),e._v(" 处理环节，首先 "),t("code",[e._v("@vue/component-compiler-utils")]),e._v(" "),t("code",[e._v(".parse")]),e._v(" 方法可以将 .vue 文件按照 "),t("strong",[e._v("template/script/style")]),e._v(" 分成代码块，此时会根据文件路径和文件内容生成 "),t("code",[e._v("hash")]),e._v(" 值，并赋给 id ，跟在文件参数后面；")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('// 形如 `id=7ba5bd90` ：\n// template\nimport {render,staticRenderFns} from "./App.vue?vue&type=template&id=7ba5bd90&scoped=true&";\n// script\nimport script from "./App.vue?vue&type=script&lang=js&";\n// style \nimport style0 from "./App.vue?vue&type=style&index=0&id=7ba5bd90&scoped=true&lang=css&";\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("blockquote",[t("p",[e._v("三、对于 style 代码块，vue-loader 会在 css-loader 前增加"),t("code",[e._v("stylePostLoader")]),e._v("，"),t("code",[e._v("stylePostLoader")]),e._v(" 正是 Vue scoped 的原理核心之一，它会给每个选择器增加属性"),t("code",[e._v("[data-v-hash]")]),e._v(" ，这里的 hash 值就是上面的 id 值；")]),e._v(" "),t("p",[e._v("四、同时，对于 template 的 render 块，vue-loader 的 "),t("code",[e._v("normalizeComponent")]),e._v(" 方法，判断如果 vue 文件中有 scoped 的 style，则其返回的 "),t("strong",[t("code",[e._v("options._ScopedId")])]),e._v(" 为上面的 scopedId；在 vnode 渲染生成 DOM 的时候会在 dom元素上增增加 scopedId，也就是增加 data-v-hash。")])]),e._v(" "),t("blockquote",[t("p",[e._v("这样，经过上面的过程，Vue scoped 实现了 CSS 的模块私有化。")])]),e._v(" "),t("h3",{attrs:{id:"⭐⭐⭐⭐⭐-王者回答"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#⭐⭐⭐⭐⭐-王者回答"}},[e._v("#")]),e._v(" ⭐⭐⭐⭐⭐ 王者回答")]),e._v(" "),t("p",[e._v("不知道。。。")]),e._v(" "),t("p",[e._v("不过，，，这影响我单手开法拉利吗？")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b22317162644b21abf5bbc8b9a0ec2e~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),e._v(" "),t("hr"),e._v(" "),t("blockquote",[t("p",[e._v("OK，以上便是本篇分享。 觉得不错点个赞吧👍👍👍，您的鼓励，我的动力，坚持输出质量好文~~ 欢迎评论留言 我是掘金安东尼，输出暴露输入，技术洞见生活。再会吧~~ 👋👋👋")])])])}),[],!1,null,null,null);v.default=r.exports}}]);