(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{741:function(n,s,a){"use strict";a.r(s);var e=a(2),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("p",[n._v("携手创作，共同成长！这是我参与「掘金日新计划 · 8 月更文挑战」的第19天，"),a("a",{attrs:{href:"https://juejin.cn/post/7123120819437322247",title:"https://juejin.cn/post/7123120819437322247",target:"_blank",rel:"noopener noreferrer"}},[n._v("点击查看活动详情"),a("OutboundLink")],1)]),n._v(" "),a("hr"),n._v(" "),a("p",[n._v("减轻阅读负担，启发创作心智，轻松学习 JavaScript 技巧，日拱一卒，jym，冲~")]),n._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5baeb2f877364de68cd24b2c62fdca1f~tplv-k3u1fbpfcp-watermark.image?",alt:"take-it-easy-relax.gif"}})]),n._v(" "),a("p",[n._v("本篇带来 —— JavaScript 剪贴板 Clipboard 的那些事儿！")]),n._v(" "),a("hr"),n._v(" "),a("p",[n._v("复制粘贴就是互联网最伟大的发明，无论是使用快捷键 ctrl c 、ctrl v，还是鼠标选中右键复制再粘贴，Copy 操作都是非常简单的。")]),n._v(" "),a("p",[n._v("然而要注意的是，你的剪贴板 Clipboard 或许在被有些软件无时无刻的监听着，有时候在知乎上搜的东西，最终出现在了京东商品的推荐页里，让人不禁打个冷战，疑问道：它怎么知道我想买这个东西的？")]),n._v(" "),a("p",[n._v("在 JavaScript 中 "),a("code",[n._v("navigator.clipboard")]),n._v(" 全局对象就是来处理剪贴板的，它有以下方法：")]),n._v(" "),a("ul",[a("li",[n._v("readText: 读文本")]),n._v(" "),a("li",[n._v("read: 读任何类型的数据，除文本外还有图片这些；")]),n._v(" "),a("li",[n._v("writeText: 写文本")]),n._v(" "),a("li",[n._v("write: 写任何数据；")])]),n._v(" "),a("p",[n._v("接下来我们实战来看看 "),a("code",[n._v("navigator.clipboard")]),n._v(" 的代码应用：")]),n._v(" "),a("h2",{attrs:{id:"写入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#写入"}},[n._v("#")]),n._v(" 写入")]),n._v(" "),a("p",[n._v("原生 JS 实现将数据写入剪贴板：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('<html>\n    <head>\n        <script >\n            async function copyText() {\n                let textArea = document.getElementById("myText")\n\n                const permission = await navigator.permissions.query({ name: \'clipboard-write\' });\n                if (permission.state === \'denied\') {\n                    return console.error("Damn, we don\'t have permissions to do this")\n                }\n                try {\n                    await navigator.clipboard.writeText(textArea.value) // 写入文本\n                    console.log("done!")\n                } catch (e) {\n                    console.error("Error while copying text!")\n                    console.error(e.message)\n                }\n\n            }\n        <\/script>\n    </head>\n    <body>\n        <textarea rows="5" cols="89" id="myText"></textarea>\n        <button onclick="copyText()">Share!</button>\n    </body>\n</html>\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br")])]),a("p",[n._v("这里要注意的是，在我们写入之前要访问 "),a("code",[n._v("navigator.permissions.query({ name: 'clipboard-write' });")]),n._v(" 用于提前判断我们是否有权限去做写入操作。")]),n._v(" "),a("p",[n._v("除了写入文本，还可以写入图片：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('<html>\n    <head>\n        <script >\n            async function copyImg() {\n                const type = "image/png";\n\n                let myImg = document.getElementById("myImage")\n\n                let img = await fetch(myImg.getAttribute("src"))\n\n                var blob = new Blob([await img.blob()], { type });\n                var data = [new ClipboardItem({ [type]: blob })];\n\n                try {\n                    await navigator.clipboard.write(data)\n                    console.log("The image was copied")\n                } catch (e) {\n                    console.error("There was a problem copying the imagge")\n                    console.error(e)\n                }\n            }\n        <\/script>\n    </head>\n    <body>\n        <img src="./img.png" width="300" id="myImage" />\n        <button onclick="copyImg()">Share!</button>\n    </body>\n</html>\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br")])]),a("p",[n._v("与文本稍有不同的是我们要包装一个 ClipboardItem 数组；")]),n._v(" "),a("h2",{attrs:{id:"读取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读取"}},[n._v("#")]),n._v(" 读取")]),n._v(" "),a("p",[n._v("与写入数据对应的就是读取数据：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("<html>\n<head>\n    <script >\n        async function pasteImage() {\n            let destinationImage = document.getElementById(\"myImage\")\n            const permission = await navigator.permissions.query({ name: 'clipboard-read' });\n            if (permission.state === 'denied') {\n                throw new Error('Not allowed to read clipboard.');\n            }\n            const clipboardContents = await navigator.clipboard.read();\n            for (const item of clipboardContents) {\n                if (!item.types.includes('image/png')) {\n                    throw new Error('Clipboard contains non-image data.');\n                }\n                const blob = await item.getType('image/png');\n                destinationImage.src = URL.createObjectURL(blob);\n            }\n        }\n        \n    <\/script>\n</head>\n<body>\n    <img  width=\"300\" id=\"myImage\" />\n    <button onclick=\"pasteImage()\">Get Image!</button>\n</body>\n</html>\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br")])]),a("p",[n._v("同样需要先确认是否有权限读取："),a("code",[n._v("navigator.permissions.query({ name: 'clipboard-read' })")])]),n._v(" "),a("p",[n._v("读取图片要用到："),a("code",[n._v("URL.createObjectURL")]),n._v(" 方法。")]),n._v(" "),a("h2",{attrs:{id:"混淆剪贴内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#混淆剪贴内容"}},[n._v("#")]),n._v(" 混淆剪贴内容")]),n._v(" "),a("p",[n._v("这里再提供一个小技巧：假设我们不想自己的文本内容被复制，除了禁止复制以外，还可以用 JS 脚本设置给它赋值一个内容混淆过的内容。")]),n._v(" "),a("p",[n._v("代码如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('<html>\n<head>\n    <script >\n        function setUpEvent() {\n            let mainContent = document.getElementById("main-content")\n\n            mainContent.addEventListener(\'copy\', function(evt) {\n                let selectedText = document.getSelection()\n                selectedText = selectedText\n                                .toString()\n                                .split("") //turn it into an array of characters\n                                .sort((a,b) => Math.random() > 0.5?1:-1) //shuffle the array\n                                .join("") //join it back into a single string\n                evt.clipboardData.setData("text/plain", selectedText) //set the clipboard\'s data\n                evt.preventDefault()\n            })\n        }\n        \n    <\/script>\n</head>\n<body onload="setUpEvent()">\n    <p id="main-content">\n    For this example, I\'m using the HTML IMG tag just to get the src atttribute, since I can\'t really use the element directly. The API needs me to turn the image into a Blob (which is essentially a way of saying "It\'s a big chunk of I don\'t know exactly"). And since the DOM API doesn\'t have any methods I can use, I\'m fetching the actual image and the calling the blob method on the response object (line 11).\nThe rest is as expected, I create a one-element array with a ClipboardItem containing the blob, and the I write the array into the clipboard.\nYou can use the above example to extrapolate how you would go about copying something else, like an XLS file. You need to fetch it, blob it, and make sure you used the right mime-type, which is the string I have on the type variable. If you don\'t know what\'s the mime-type for your file, just Google "mime-type for <your file\'s extension here>" and you\'ll have it.\n    </p>\n</body>\n</html>\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br")])]),a("p",[n._v("我们可以在 https://www.runoob.com/runcode 即时运行这段代码看看混淆后的剪贴板的内容：")]),n._v(" "),a("p",[n._v("粘贴出来是这样的：")]),n._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0ffb2dbcd7741ddae8962a9a48e1c78~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),n._v(" "),a("p",[n._v("主要用到了随机数去打乱内容。")]),n._v(" "),a("p",[n._v("挺有意思的，不是让人不能复制，而是让人复制一个乱序的结果，Clipboard 也能这样玩儿~~")]),n._v(" "),a("blockquote",[a("p",[n._v("OK，以上便是本篇分享。点赞关注评论，为好文助力👍")]),n._v(" "),a("p",[n._v("我是掘金安东尼 🤠 100 万人气前端技术博主 💥 INFP 写作人格坚持 1000 日更文 ✍ 关注我，安东尼陪你一起度过漫长编程岁月 🌏")])])])}),[],!1,null,null,null);s.default=t.exports}}]);