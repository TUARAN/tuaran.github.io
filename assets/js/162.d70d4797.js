(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{661:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("本文为稀土掘金技术社区首发签约文章，14天内禁止转载，14天后未获授权禁止转载，侵权必究!")]),s._v(" "),a("h2",{attrs:{id:"专栏简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#专栏简介"}},[s._v("#")]),s._v(" 专栏简介")]),s._v(" "),a("blockquote",[a("p",[s._v("作为一名 5 年经验的 JavaScript 技能拥有者，笔者时常在想，它的核心是什么？后来我确信答案是：闭包和异步。而函数式编程能完美串联了这两大核心，从高阶函数到函数组合；从无副作用到延迟处理；从函数响应式到事件流，从命令式风格到代码重用。所以，本专栏将从函数式编程角度来再看 JavaScript 精要，欢迎关注！"),a("a",{attrs:{href:"https://juejin.cn/column/7140154838981017613",title:"https://juejin.cn/column/7140154838981017613",target:"_blank",rel:"noopener noreferrer"}},[s._v("传送门"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("blockquote",[a("p",[s._v("在 JS 中谈到 “响应式” ，你会想起什么？")])]),s._v(" "),a("p",[a("strong",[s._v("1.")]),s._v(" 最初的 "),a("code",[s._v("Object.observe")]),s._v(" ，已经被弃用了。。。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a70434446174b949917f0f05d53c2fc~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("strong",[s._v("3.")]),s._v(" 还有 "),a("code",[s._v("Object.defineProperty")]),s._v("，它是 Vue2 响应式的核心。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0025b53e427c44bcb3f8e0399785eb84~tplv-k3u1fbpfcp-watermark.image?",alt:"vue2-org.jpeg"}})]),s._v(" "),a("p",[a("strong",[s._v("2.")]),s._v(" 后来，ES6 有 "),a("code",[s._v("Proxy")]),s._v(" 劫持了，很棒，Vue3 就是基于它的。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/225d4299790540bfb6664751a620d968~tplv-k3u1fbpfcp-watermark.image?",alt:"vue3-org.png"}})]),s._v(" "),a("p",[a("strong",[s._v("4.")]),s._v(" 再有，React 一词的中文就是“反应”、“响应”的意思，"),a("code",[s._v("hooks")]),s._v(" 是 react 的最新“响应式”的解决方案；")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c158f7df188149acb8b1e75a6250122a~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("还有吗？ —— 其实在原生 JS 中还有~")]),s._v(" "),a("p",[a("strong",[s._v("5.")]),s._v(" 比如 "),a("code",[s._v("addEventListener")]),s._v("，也是一种响应式吧，当目标元素被点击后，就会通知一个回调函数，进行特定的操作。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var handler = (e) => {\n\tconsole.log(e);\n\tdocument.body.removeEventListener('click', handler);\n}\n\ndocument.body.addEventListener('click', handler);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("6.")]),s._v(" 还有，比如考察 Event loop ，常要背的微任务："),a("code",[s._v("MutationObserver")]),s._v(" 一定也别忘记。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 得到要观察的元素\nvar elementToObserve = document.querySelector(\"#targetElementId\");\n\n// 创建一个叫 `observer` 的新 `MutationObserver` 实例，\n// 并将回调函数传给它\nvar observer = new MutationObserver(function() {\n    console.log('callback that runs when observer is triggered');\n});\n\n// 在 MutationObserver 实例上调用 `observe` 方法，\n// 并将要观察的元素与选项传给此方法\nobserver.observe(elementToObserve, {subtree: true, childList: true});\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("strong",[s._v("7.")]),s._v(" 还有，设计模式中常问的“观察者模式”，这个面试常考。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Producer {\n\tconstructor() {\n\t\tthis.listeners = [];\n\t}\n\taddListener(listener) {\n\t\tif(typeof listener === 'function') {\n\t\t\tthis.listeners.push(listener)\n\t\t} else {\n\t\t\tthrow new Error('listener 必须是 function')\n\t\t}\n\t}\n\tremoveListener(listener) {\n\t\tthis.listeners.splice(this.listeners.indexOf(listener), 1)\n\t}\n\tnotify(message) {\n\t\tthis.listeners.forEach(listener => {\n\t\t\tlistener(message);\n\t\t})\n\t}\n}\n\nvar egghead = new Producer(); \n\nfunction listener1(message) {\n\tconsole.log(message + 'from listener1');\n}\nfunction listener2(message) {\n\tconsole.log(message + 'from listener2');\n}\negghead.addListener(listener1); // 注册监听\negghead.addListener(listener2);\negghead.notify('A new course!!') // 执行\n\n// a new course!! from listener1\n// a new course!! from listener2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[a("sub",[s._v("代码可复制在控制台中调试。")])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("通过回顾以上 7 点，“抛开其它不谈，这个响应式就没什么问题吗？”")])]),s._v(" "),a("p",[a("strong",[s._v("不得不承认：响应式思想根植在前端 Script 和 DOM 的交互中")])])]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("我们进一步想想：为什么是响应式？")])]),s._v(" "),a("p",[a("strong",[s._v("噢，其实，不为别的，就是为了偷懒！")])])]),s._v(" "),a("p",[s._v("偷懒的点在于，我们不想手动去触发函数的回调，设置响应式正是为了摆脱在时间上有异步操作而带来的困扰。")]),s._v(" "),a("p",[a("strong",[s._v("“我不管你什么时候操作，只要你操作了，就去触发XXX...”")])]),s._v(" "),a("p",[s._v("响应式可以玩出各种各样的花来，这些其实就像是同一个事物在不同角度的展现。就像小学的那篇课文：《画杨桃》一样。关键在于你怎么看，是在其中的一面看，还是以全局视角来看。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93735e8f7b2f4e0db91caa8db7128cb6~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("strong",[s._v("按照这个思路继续往前，介绍今天的主角，基于 响应式 的新的花样：Observable，—— 它是 RxJS 的最最基础、最最核心的东西。")])]),s._v(" "),a("h2",{attrs:{id:"observable-序列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#observable-序列"}},[s._v("#")]),s._v(" Observable 序列")]),s._v(" "),a("p",[s._v("整个 RxJS 最最基础的概念之一就是 Observable")]),s._v(" "),a("p",[s._v("什么是 Observable ？")]),s._v(" "),a("p",[s._v("网上看过很多解释，都不如人意，本瓜最后得出结论，不如就将其直接理解为一个 "),a("strong",[s._v("序列")]),s._v("。")]),s._v(" "),a("p",[s._v("什么是序列？")]),s._v(" "),a("p",[s._v("数组可能是我们用的最多的序列了。")]),s._v(" "),a("p",[s._v("你知道在 JS 中，数组还能这样迭代吗？")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" iterator "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" arr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Symbol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iterator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\niterator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { value: 1, done: false }")]),s._v("\niterator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { value: 2, done: false }")]),s._v("\niterator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { value: 3, done: false }")]),s._v("\niterator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// { value: undefined, done: true }")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("即使，不用 "),a("code",[s._v("Symbol.iterator")]),s._v("，我们也可以自己写一个迭代数组的方法。")]),s._v(" "),a("p",[a("strong",[s._v("自制 Iterator")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class IteratorFromArray {\n\tconstructor(arr) {\n\t\tthis._array = arr;\n\t\tthis._cursor = 0;\n\t}\n  \n\tnext() {\n\t\treturn this._cursor < this._array.length ?\n\t\t{ value: this._array[this._cursor++], done: false } :\n\t\t{ done: true };\n\t}\n}\n\nvar iterator = new IteratorFromArray([1,2,3]);\n\niterator.next();\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("有一个 next 方法，返回 "),a("code",[s._v("{value:val,done:false}")]),s._v(" 或者 "),a("code",[s._v("{done:true}")])]),s._v(" "),a("p",[s._v("这样看来，Iterator Pattern 似乎不难，但对比数组遍历它同时带来了两个优势：")]),s._v(" "),a("blockquote",[a("ol",[a("li",[a("p",[s._v("它渐进式取值的特性可以拿来做延迟运算(Lazy evaluation)，让我们能用它来处理特殊结构（前面文章提过）；")])]),s._v(" "),a("li",[a("p",[s._v("因为 iterator 本身是序列，所以可以作所有阵列的运算方法像 map, filter... 等；")])])])]),s._v(" "),a("p",[s._v("这个就厉害啦，这意味着 "),a("code",[s._v("IteratorFromArray")]),s._v(" 函数还能再进一步处理：比如用 map 的思路：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class IteratorFromArray {\n\tconstructor(arr) {\n\t\tthis._array = arr;\n\t\tthis._cursor = 0;\n\t}\n  \n\tnext() {\n\t\treturn this._cursor < this._array.length ?\n\t\t{ value: this._array[this._cursor++], done: false } :\n\t\t{ done: true };\n\t}\n\t\n\tmap(callback) {\n\t\tconst iterator = new IteratorFromArray(this._array);\n\t\treturn { \n\t\t\tnext: () => {\n\t\t\t\tconst { done, value } = iterator.next();\n\t\t\t\treturn {\n\t\t\t\t\tdone: done,\n\t\t\t\t\tvalue: done ? undefined : callback(value)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nvar iterator = new IteratorFromArray([1,2,3]);\nvar newIterator = iterator.map(value => value + 3);\n\nnewIterator.next();\n// { value: 4, done: false }\nnewIterator.next();\n// { value: 5, done: false }\nnewIterator.next();\n// { value: 6, done: false }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[s._v("“不是讲 Observable 吗，怎么讲 Iterator 去了。。。”")]),s._v(" "),a("p",[s._v("—— Observable 和 Iterator 很像、很像")]),s._v(" "),a("p",[a("strong",[s._v("它们有一样的共性，即：它们都是渐进式取值，以及适用阵列的运算。")])]),s._v(" "),a("p",[s._v("要说其唯一的区别可能是，Observable 序列更侧重于在“时间”这个维度上描述，即 Observable 的值会随着时间进行推送。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5bcfe54bb9de48b0b3ffed9504fefdf3~tplv-k3u1fbpfcp-watermark.image?",alt:"0146fe1f6d6546d5a70dc360ced10173.gif"}})]),s._v(" "),a("h2",{attrs:{id:"observable-执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#observable-执行"}},[s._v("#")]),s._v(" Observable 执行")]),s._v(" "),a("p",[a("strong",[s._v("以下所有介绍的 Observable 代码示例都可以在  "),a("a",{attrs:{href:"https://jsfiddle.net/",target:"_blank",rel:"noopener noreferrer"}},[s._v("jsfiddle"),a("OutboundLink")],1),s._v(" 下运行")])]),s._v(" "),a("p",[s._v("cdn 依赖是：https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.0.1/Rx.js")]),s._v(" "),a("h3",{attrs:{id:"同步和异步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同步和异步"}},[s._v("#")]),s._v(" 同步和异步")]),s._v(" "),a("p",[s._v("我们先测一个不带时间状态的同步的 Observable")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/511c4cddb9b54b5eb7c6c4eb75f6767c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("在控制台依次输出：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb099404defe4d0a9166ae2126aec797~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/5/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("再测一个带时间状态的 Observable")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/226068a3c8a74e9fbedaae8eebf934de~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/536f93228fd5472fb58dfc7174595b97~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("同步结束后，执行异步的回调。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/12/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("细心的你一定发现了 "),a("code",[s._v("subscribe")]),s._v(" 关键字的调用。subscribe 就是用来执行 Observable 的，就像是调用一个 function。")]),s._v(" "),a("h3",{attrs:{id:"subscribe"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#subscribe"}},[s._v("#")]),s._v(" subscribe")]),s._v(" "),a("p",[s._v("通常 subscribe 参数中的对象有三个值，分别是：next、error、complete，对应 observer 的三个状态：next、error、complete；")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var observable = Rx.Observable\n\t.create(function (observer) {\n\t\t\tobserver.next('Jerry');\n\t\t\tobserver.next('Anna');\n                        observer.complete();\n\t})\n\t\nobservable.subscribe({\n\tnext: function(value) {\n\t\tconsole.log(value);\n\t},\n\terror: function(error) {\n\t\tconsole.log(error)\n\t},\n\tcomplete: function() {\n\t\tconsole.log('complete')\n\t}\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/16/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("觉得理解起来麻烦，就通俗认为 subscribe 就是来处理 "),a("code",[s._v("observer.next")]),s._v(" 的值的~")]),s._v(" "),a("h2",{attrs:{id:"操作符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作符"}},[s._v("#")]),s._v(" 操作符")]),s._v(" "),a("p",[s._v("上述就是最简单的 Observable 推送值、取值的过程。")]),s._v(" "),a("p",[s._v("接下来，简单认识下如何新建 Observable 以及 转换 Observable 。（都知道 RxJS 操作符很强大，它们其实大部分都是来操作 Observable 的。）")]),s._v(" "),a("h3",{attrs:{id:"新建-observable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#新建-observable"}},[s._v("#")]),s._v(" 新建 Observable")]),s._v(" "),a("p",[s._v("Observable 有许多创建实例的方法，介绍最常见的几个~")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("create")])])]),s._v(" "),a("p",[s._v("create 前面都用的是这个，直接创建；")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("of")])])]),s._v(" "),a("p",[s._v("当我们想要同步的传递多个值时，可以用 of 这个 operator 来作简洁的表达")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.of('Jerry', 'Anna');\n\nsource.subscribe(console.log);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/27/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("from")])])]),s._v(" "),a("p",[s._v("还可以用 from 来接收数组，创建 Observable")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var arr = ['Jerry', 'Anna', 123, 456, 'juejin'] \nvar source = Rx.Observable.from(arr);\nsource.subscribe(console.log);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/30/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("fromEvent")])])]),s._v(" "),a("p",[s._v("fromEvent 可以新建一个事件的 Observable")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.fromEvent(document.body, 'click');\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("还有比如 "),a("code",[s._v("fromEventPattern")]),s._v(" 可以新建类事件 Observable ，比如同时具有添加监听、移除监听的方法。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("interval")])])]),s._v(" "),a("p",[s._v("每隔一定时间间隔产生值的 Observable")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.interval(1000);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"转换-observable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#转换-observable"}},[s._v("#")]),s._v(" 转换 Observable")]),s._v(" "),a("p",[s._v("常见的转换 Observable 比如像是 map, filter, contactAll......等等，所有这些函数都会拿到原本的observable 并回传一个新的observable。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("map")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 生成一个间隔为1秒的时间序列，每秒输出的值为秒数*2\n\nvar source = Rx.Observable.interval(1000);\nvar newest = source.map(x => x*2); \nnewest.subscribe(console.log);\n\n// 0\n// 2\n// 4\n// 6\n...\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/20/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("filter")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 生成一个间隔为1秒的时间序列，过滤掉奇数秒\n\nvar source = Rx.Observable.interval(1000);\nvar newest = source.filter(x => x % 2 === 0); \nnewest.subscribe(console.log);\n\n// 0\n// 2\n// 4\n// 6\n..\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/21/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("concatAll")])])]),s._v(" "),a("p",[s._v("有时我们的 Observable 送出的元素又是一个 observable，就像是二维阵列，阵列里面的元素是阵列。")]),s._v(" "),a("p",[s._v("这时我们就可以用 concatAll 把它摊平成一维阵列，concatAll 把所有元素 concat 起来。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 生成一个间隔为1秒的时间序列，取前 5 个值，\n// 再生成一个间隔为 0.5 秒的时间序列，取前 2 个值\n// 再生成一个间隔为 2 秒的时间序列，取前 1 个值\n// 把这些值返回给一个 Observable，相当于是二维的 Observable，再用 concatAll 拉平；\n\nvar obs1 = Rx.Observable.interval(1000).take(5);\nvar obs2 = Rx.Observable.interval(500).take(2);\nvar obs3 = Rx.Observable.interval(2000).take(1);\nvar source = Rx.Observable.of(obs1, obs2, obs3);\nvar example = source.concatAll();\nexample.subscribe(console.log);\n// 0\n// 1\n// 2\n// 3\n// 4\n// 0\n// 1\n// 0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("时间线的弹珠图示意：（ps: 不懂弹珠图的可看下一小节释义）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source : (o1                 o2      o3)|\n           \\                  \\       \\\n            --0--1--2--3--4|   -0-1|   ----0|\n            \n                    concatAll()\n                    \nexample: --0--1--2--3--4-0-1----0|\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/22",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("observable 操作的 API 有很多，一下子就记全、记清也是不现实的，我们应该 "),a("strong",[s._v("在学中用，在用中记")]),s._v("，多看几遍就熟了，常用、关键的方法其实也不多。 "),a("a",{attrs:{href:"https://cn.rx.js.org/manual/overview.html#h213",target:"_blank",rel:"noopener noreferrer"}},[s._v("rx.js.org-操作符分类"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"弹珠图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#弹珠图"}},[s._v("#")]),s._v(" 弹珠图")]),s._v(" "),a("p",[s._v("我们在传达事物时，文字其实是最糟的手段，虽然文字是我们平时沟通的基础，但常常千言万语也比不过一张清楚的图。")]),s._v(" "),a("p",[s._v("我们把描绘 observable 的图示称为弹珠图。")]),s._v(" "),a("p",[s._v("用 "),a("code",[s._v("-")]),s._v(" 来表达一小段时间，这些 "),a("code",[s._v("-")]),s._v(" 串起就代表一个observable。"),a("code",[s._v("|")]),s._v("则代表observable 结束")]),s._v(" "),a("p",[s._v("比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.interval(1000);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("弹珠图：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("-----0-----1-----2-----3--...\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.interval(1000);\nvar newest = source.map(x => x + 1); \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("弹珠图：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source: -----0-----1-----2-----3--...\n            map(x => x + 1)\nnewest: -----1-----2-----3-----4--...\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"最常用操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最常用操作"}},[s._v("#")]),s._v(" 最常用操作")]),s._v(" "),a("p",[s._v("当操作比较复杂的时候，需要用到弹珠图来理解，https://rxviz.com/ 这个网站可以专门来绘制弹珠图。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("merge")])])]),s._v(" "),a("p",[s._v("merge 用来合并 observable")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.interval(500).take(3);\nvar source2 = Rx.Observable.interval(300).take(6);\nvar example = source.merge(source2);\nexample.subscribe(console.log);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source : ----0----1----2|\nsource2: --0--1--2--3--4--5|\n            merge()\nexample: --0-01--21-3--(24)--5|\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/32/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("可以看到 merge 和 concatAll 有区别：concatAll 是一个 Observable 彻底走完，再走下一个，merge 是同时跑，不管谁先推送值，都将其先取。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("combineLatest")])])]),s._v(" "),a("p",[s._v("它会取得各个 observable 最后送出的值，再输出成一个值；")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var source = Rx.Observable.interval(500).take(3);\nvar newest = Rx.Observable.interval(300).take(6);\nvar example = source.combineLatest(newest, (x, y) => x + y);\nexample.subscribe(console.log);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("source : ----0----1----2|\nnewest : --0--1--2--3--4--5|\n    combineLatest(newest, (x, y) => x + y);\nexample: ----01--23-4--(56)--7|\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/34/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[a("code",[s._v("withLatestFrom")])])]),s._v(" "),a("p",[s._v("withLatestFrom 运作方式跟 combineLatest 有点像，只是他有主从的关系，只有在主要的 observable 送出新的值时，才会执行 callback；")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var main = Rx.Observable.from('hello').zip(Rx.Observable.interval(500), (x, y) => x);\nvar some = Rx.Observable.from([0,1,0,0,0,1]).zip(Rx.Observable.interval(300), (x, y) => x);\nvar example = main.withLatestFrom(some, (x, y) => {\n    return y === 1 ? x.toUpperCase() : x;\n});\n\nexample.subscribe(console.log);\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("main   : ----h----e----l----l----o|\nsome   : --0--1--0--0--0--1|\nwithLatestFrom(some, (x, y) =>  y === 1 ? x.toUpperCase() : x);\nexample: ----h----e----l----L----O|\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/36/",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试地址"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[s._v("#")]),s._v(" 实战")]),s._v(" "),a("p",[s._v("OK，理论讲太多，也会乏味。就上面的 api 其实就已经够了，我们可以通过他们用短短几行代码实现复杂的功能。")]),s._v(" "),a("h3",{attrs:{id:"基础拖拉"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础拖拉"}},[s._v("#")]),s._v(" 基础拖拉")]),s._v(" "),a("p",[s._v("短短 15 行代码就可以实现一个基础的拖拽功能。"),a("a",{attrs:{href:"https://jsfiddle.net/tuaran1453/qap48gz7/39/",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6b430ffdc794ec188fee7f85c6160ab~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" dragDOM "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'drag'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" body "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseDown "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dragDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mousedown'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseUp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mouseup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseMove "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mousemove'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmouseDown\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" mouseMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("takeUntil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mouseUp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("concatAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" y"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("pos")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dragDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("left "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'px'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    dragDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("top "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("y "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'px'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("思路：")]),s._v(" "),a("ol",[a("li",[s._v("获取 dragDOM")]),s._v(" "),a("li",[s._v("用 "),a("code",[s._v("fromEvent")]),s._v(" 创建 mousedown、mouseup、mousemove 事件。")]),s._v(" "),a("li",[s._v("当第一次 mouseDown 时，监听 mouseMove，直到 mouseUp；")]),s._v(" "),a("li",[s._v("这个过程中，修改 dragDOM 的left、top 值；")])]),s._v(" "),a("p",[s._v("只要能看懂 Observable operators，代码可读性非常高。既简洁，又易维护。")]),s._v(" "),a("h3",{attrs:{id:"视频拖拉"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视频拖拉"}},[s._v("#")]),s._v(" 视频拖拉")]),s._v(" "),a("p",[s._v("接着拖拽的需求，再进一步。")]),s._v(" "),a("p",[s._v("我们在网页中看视频的时候，经常遇到这样的场景：下拉滚动条，视频缩放到右小角，并且可以拖拽。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a3e51e37e71495dbc9380b2fe05b9ab~tplv-k3u1fbpfcp-watermark.image?",alt:"apply.gif"}})]),s._v(" "),a("p",[s._v("用 RxJS Observable，35 行代码即能实现：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" video "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'video'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" anchor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'anchor'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" scroll "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scroll'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseDown "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mousedown'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseUp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mouseup'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" mouseMove "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Rx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fromEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mousemove'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("validValue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" min"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nscroll\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" anchor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getBoundingClientRect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bottom "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("bool")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'video-fixed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'video-fixed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmouseDown\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("classList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'video-fixed'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" mouseMove"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("takeUntil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mouseUp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("concatAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("withLatestFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mouseDown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("move"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" down")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            x"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("validValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("move"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientX "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("offsetX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerWidth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("320")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            y"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("validValue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("move"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("clientY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("offsetY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("innerHeight "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("180")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("pos")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("top "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("y "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'px'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        video"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("left "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'px'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("思路分为 3 部分：")]),s._v(" "),a("ol",[a("li",[s._v("获取 DOM 以及鼠标事件；")]),s._v(" "),a("li",[s._v("监听滚动，当包含视频的 dom 相对于浏览器视窗的位置小于 0 ，则说明已触底。给视频添加一个标识；")]),s._v(" "),a("li",[s._v("拖拽；")])]),s._v(" "),a("p",[s._v("备注：validValue 是为了不让视频超出浏览器视窗之外。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://jsfiddle.net/s6323859/ochbtpk5/3/",target:"_blank",rel:"noopener noreferrer"}},[s._v("在线测试地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("代码真的太凝练了~")]),s._v(" "),a("h2",{attrs:{id:"结语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),a("p",[s._v("本篇， 我们讲到了响应式的思想其实根植在前端开发的 Script 和 Dom 的交互中。根绝这种思想，衍生了很多写法，但是万变不离其宗，都是“响应式”。")]),s._v(" "),a("p",[s._v("响应式的另一种展示：RxJS Observable 又换了一个新的马甲，监听动作、沿着时间线去推送值、渐进式取值、值可以作阵列变化（map、filter 等等），这是本篇核心。")]),s._v(" "),a("p",[s._v("我们可以借助 操作符，用极少的代码量实现较为复杂的功能，代码看起来非常简洁、清晰。")]),s._v(" "),a("p",[s._v("感受感受事件流，只是善用这些操作符还需要时间来学习、使用、沉淀。。。")]),s._v(" "),a("hr"),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e60bd64aedc14f5c9ec05113bbd449e6~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("OK，以上便是本篇分享，专栏第 6 篇，希望各位工友喜欢~ 欢迎点赞、收藏、评论 🤟")]),s._v(" "),a("p",[s._v("关注专栏 "),a("a",{attrs:{href:"https://juejin.cn/column/7140154838981017613",title:"https://juejin.cn/column/7140154838981017613",target:"_blank",rel:"noopener noreferrer"}},[s._v("# JavaScript 函数式编程精要 —— 签约作者安东尼"),a("OutboundLink")],1)]),s._v(" "),a("blockquote",[a("p",[s._v("我是掘金安东尼 🤠 100 万人气前端技术博主 💥 INFP 写作人格坚持 1000 日更文 ✍ 关注我，安东尼陪你一起度过漫长编程岁月 🌏")])])])}),[],!1,null,null,null);t.default=e.exports}}]);