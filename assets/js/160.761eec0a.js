(window.webpackJsonp=window.webpackJsonp||[]).push([[160],{654:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("通译自："),e("a",{attrs:{href:"https://betterprogramming.pub/6-major-features-of-node-js-19-b98e28b9670c",target:"_blank",rel:"noopener noreferrer"}},[s._v("6 Major Features of Node.js 19. Details of Node.js 19 new features… | by Jennifer Fu | Oct, 2022 | Better Programming"),e("OutboundLink")],1)]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("Node 19 在 2022-10-18 发布。")]),s._v(" "),e("p",[s._v("我们知道 Node.js 版本分两种：LTS 和 Current")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e1a337f186644768dfdb9da7a5c4503~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),e("p",[s._v("其中，Current 版本通常每 6 个月发布一次。")]),s._v(" "),e("p",[s._v("每年 4 月份发布新的偶数版本；")]),s._v(" "),e("p",[s._v("每年 10 月份发布新的奇数版本；")]),s._v(" "),e("p",[s._v("在刚过去的 10 月，发布的 V19.0.1 成为最新的 “Current” 尝鲜版，它一共带来 6 大特性。")]),s._v(" "),e("h2",{attrs:{id:"_1-http-s-1-1-keepalive-默认为-true"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-http-s-1-1-keepalive-默认为-true"}},[s._v("#")]),s._v(" 1. HTTP(S)/1.1 KeepAlive 默认为 true")]),s._v(" "),e("p",[s._v("Node.js v19 设置 keepAlive 默认值为 true，这意味着所有出站的 HTTP(s) 连接都将使用 HTTP 1.1 keepAlive，默认时间为 5S；")]),s._v(" "),e("p",[s._v("代码测试：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const http = require('node:http');\nconsole.log(http.globalAgent);\nconst https = require('node:https');\nconsole.log(https.globalAgent);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("我们可以对比看看 v16 和 v19 的 node server Agent 配置差异：")]),s._v(" "),e("ul",[e("li",[s._v("V16")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("% nvm use 16\nNow using node v16.0.0 (npm v7.10.0)\n% node server\nAgent {\n  _events: [Object: null prototype] {\n    free: [Function (anonymous)],\n    newListener: [Function: maybeEnableKeylog]\n  },\n  _eventsCount: 2,\n  _maxListeners: undefined,\n  defaultPort: 80,\n  protocol: 'http:',\n  options: [Object: null prototype] { path: null },\n  requests: [Object: null prototype] {},\n  sockets: [Object: null prototype] {},\n  freeSockets: [Object: null prototype] {},\n  keepAliveMsecs: 1000,\n  keepAlive : false,\n  maxSockets: Infinity,\n  maxFreeSockets: 256,\n  scheduling: 'lifo',\n  maxTotalSockets: Infinity,\n  totalSocketCount: 0,\n  [Symbol(kCapture)]: false\n}\nAgent {\n  _events: [Object: null prototype] {\n    free: [Function (anonymous)],\n    newListener: [Function: maybeEnableKeylog]\n  },\n  _eventsCount: 2,\n  _maxListeners: undefined,\n  defaultPort: 443,\n  protocol: 'https:',\n  options: [Object: null prototype] { path: null },\n  requests: [Object: null prototype] {},\n  sockets: [Object: null prototype] {},\n  freeSockets: [Object: null prototype] {},\n  keepAliveMsecs: 1000,\n  keepAlive: false,\n  maxSockets: Infinity,\n  maxFreeSockets: 256,\n  scheduling: 'lifo',\n  maxTotalSockets: Infinity,\n  totalSocketCount: 0,\n  maxCachedSessions: 100,\n  _sessionCache: { map: {}, list: [] },\n  [Symbol(kCapture)]: false\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br")])]),e("p",[s._v("第 18、40 行，keepAlive 默认设置为 false；")]),s._v(" "),e("ul",[e("li",[s._v("V19")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("% nvm use 19\nNow using node v19.0.0 (npm v8.19.2)\n% node server\nAgent {\n  _events: [Object: null prototype] {\n    free: [Function (anonymous)],\n    newListener: [Function: maybeEnableKeylog]\n  },\n  _eventsCount: 2,\n  _maxListeners: undefined,\n  defaultPort: 80,\n  protocol: 'http:',\n  options: [Object: null prototype] {\n    keepAlive: true,\n    scheduling: 'lifo',\n    timeout: 5000,\n    noDelay: true,\n    path: null\n  },\n  requests: [Object: null prototype] {},\n  sockets: [Object: null prototype] {},\n  freeSockets: [Object: null prototype] {},\n  keepAliveMsecs: 1000,\n  keepAlive: true,\n  maxSockets: Infinity,\n  maxFreeSockets: 256,\n  scheduling: 'lifo',\n  maxTotalSockets: Infinity,\n  totalSocketCount: 0,\n  [Symbol(kCapture)]: false\n}\nAgent {\n  _events: [Object: null prototype] {\n    free: [Function (anonymous)],\n    newListener: [Function: maybeEnableKeylog]\n  },\n  _eventsCount: 2,\n  _maxListeners: undefined,\n  defaultPort: 443,\n  protocol: 'https:',\n  options: [Object: null prototype] {\n    keepAlive: true,\n    scheduling: 'lifo',\n    timeout: 5000,\n    noDelay: true,\n    path: null\n  },\n  requests: [Object: null prototype] {},\n  sockets: [Object: null prototype] {},\n  freeSockets: [Object: null prototype] {},\n  keepAliveMsecs: 1000,\n  keepAlive: true,\n  maxSockets: Infinity,\n  maxFreeSockets: 256,\n  scheduling: 'lifo',\n  maxTotalSockets: Infinity,\n  totalSocketCount: 0,\n  maxCachedSessions: 100,\n  _sessionCache: { map: {}, list: [] },\n  [Symbol(kCapture)]: false\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br")])]),e("p",[s._v("第 14、16、42、44 行设置 keepAlive 默认值及时间；")]),s._v(" "),e("p",[s._v("启用 keepAlive 能使连接重用，提高网络的吞吐量。")]),s._v(" "),e("p",[s._v("另外，服务器将在调用 "),e("code",[s._v("close()")]),s._v(" 自动断开空闲的客户端，内部依靠 "),e("code",[s._v("http(s).Server.close")]),s._v(" API 实现；")]),s._v(" "),e("p",[s._v("这些修改，进一步优化了体验和性能。")]),s._v(" "),e("h2",{attrs:{id:"_2-稳定的-webcrypto-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-稳定的-webcrypto-api"}},[s._v("#")]),s._v(" 2. 稳定的 WebCrypto API")]),s._v(" "),e("p",[s._v("WebCrypto API 是一个使用密码学构建的系统接口，在 node.js v19 趋于稳定（除 Ed25519、Ed448、X25519、X448 外）。")]),s._v(" "),e("p",[s._v("我们可以通过调用 "),e("code",[s._v("globalThis.crypto")]),s._v(" 或 "),e("code",[s._v("require('node:crypto').webcrypto")]),s._v(" 来访问，下面以 "),e("code",[s._v("subtle")]),s._v(" 加密函数为例；")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nconst { subtle } = globalThis.crypto;\n\n(async function() {\n\n  const key = await subtle.generateKey({\n    name: 'HMAC',\n    hash: 'SHA-256',\n    length: 256\n  }, true, ['sign', 'verify']);\n\n  console.log('key =', key);\n\n  const enc = new TextEncoder();\n  const message = enc.encode('I love cupcakes');\n\n  console.log('message =', message);\n\n  const digest = await subtle.sign({\n    name: 'HMAC'\n  }, key, message);\n\n  console.log('digest =', digest);\n\n})();\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("首先生成 HMAC 密钥，生成的密钥可同时用于验证消息数据完整性和真实性；")]),s._v(" "),e("p",[s._v("然后，对字符串 "),e("code",[s._v("I love cupcakes")]),s._v(" 加密；")]),s._v(" "),e("p",[s._v("最后创建 消息摘要，它是一种加密散列函数；")]),s._v(" "),e("p",[s._v("在控制台显示：key 、message 、digest 信息")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("% node server\nkey = CryptoKey {\n  type: 'secret',\n  extractable: true,\n  algorithm: { name: 'HMAC', length: 256, hash: [Object] },\n  usages: [ 'sign', 'verify' ]\n}\nmessage = Uint8Array(15) [\n   73, 32, 108, 111, 118,\n  101, 32,  99, 117, 112,\n   99, 97, 107, 101, 115\n]\ndigest = ArrayBuffer {\n  [Uint8Contents]: <30 01 7a 5c d9 e2 82 55 6b 55 90 4f 1d de 36 d7 89 dd fb fb 1a 9e a0 cc 5d d8 49 13 38 2f d1 bc>,\n  byteLength: 32\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("h2",{attrs:{id:"_3-自定义-esm-resolution-调整"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-自定义-esm-resolution-调整"}},[s._v("#")]),s._v(" 3. 自定义 ESM resolution 调整")]),s._v(" "),e("p",[s._v("Node.js 已经删除 "),e("code",[s._v("--experimental-specifier-resolution")]),s._v("，其功能现在可以通过自定义加载器实现。")]),s._v(" "),e("p",[s._v("可以在这个库中测试："),e("a",{attrs:{href:"https://github.com/nodejs/loaders-test",target:"_blank",rel:"noopener noreferrer"}},[s._v("nodejs/loaders-test: Examples demonstrating the Node.js ECMAScript Modules Loaders API"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("git clone https://github.com/nodejs/loaders-test.git\n\n% cd loaders-test/commonjs-extension-resolution-loader\n\n% yarn install\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("比如 "),e("code",[s._v("loaders-test/commonjs-extension-resolution-loader/test/basic-fixtures/index.js")]),s._v(" 文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { version } from 'process';\n\nimport { valueInFile } from './file';\nimport { valueInFolderIndex } from './folder';\n\nconsole.log(valueInFile);\nconsole.log(valueInFolderIndex);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[e("code",[s._v("./file")]),s._v(" 如果没有自定义加载器，不会去查找文件的扩展名，比如 "),e("code",[s._v("./file.js")]),s._v(" 或 "),e("code",[s._v("./file.mjs")])]),s._v(" "),e("p",[s._v("设置自定义加载器后，则可解决上述问题：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import { isBuiltin } from 'node:module';\nimport { dirname } from 'node:path';\nimport { cwd } from 'node:process';\nimport { fileURLToPath, pathToFileURL } from 'node:url';\nimport { promisify } from 'node:util';\n\nimport resolveCallback from 'resolve/async.js';\n\nconst resolveAsync = promisify(resolveCallback);\n\nconst baseURL = pathToFileURL(cwd() + '/').href;\n\n\nexport async function resolve(specifier, context, next) {\n  const { parentURL = baseURL } = context;\n\n  if (isBuiltin(specifier)) {\n    return next(specifier, context);\n  }\n\n  // `resolveAsync` works with paths, not URLs\n  if (specifier.startsWith('file://')) {\n    specifier = fileURLToPath(specifier);\n  }\n  const parentPath = fileURLToPath(parentURL);\n\n  let url;\n  try {\n    const resolution = await resolveAsync(specifier, {\n      basedir: dirname(parentPath),\n      // For whatever reason, --experimental-specifier-resolution=node doesn't search for .mjs extensions\n      // but it does search for index.mjs files within directories\n      extensions: ['.js', '.json', '.node', '.mjs'],\n    });\n    url = pathToFileURL(resolution).href;\n  } catch (error) {\n    if (error.code === 'MODULE_NOT_FOUND') {\n      // Match Node's error code\n      error.code = 'ERR_MODULE_NOT_FOUND';\n    }\n    throw error;\n  }\n\n  return next(url, context);\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br")])]),e("p",[s._v("测试命令：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("% node --loader=./loader.js test/basic-fixtures/index  \n(node:56149) ExperimentalWarning: Custom ESM Loaders is an experimental feature. This feature could change at any time\n(Use `node --trace-warnings ...` to show where the warning was created)\nhello from file.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("将不会再报错，正常运行。")]),s._v(" "),e("h2",{attrs:{id:"_4-移除对-dtrace-systemtap-etw-支持"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-移除对-dtrace-systemtap-etw-支持"}},[s._v("#")]),s._v(" 4. 移除对 DTrace/SystemTap/ETW 支持")]),s._v(" "),e("p",[s._v("在 Node.js v19中，移除了对 DTrace/SystemTap/ETW 的支持，主要是因为资源的优先级问题。")]),s._v(" "),e("p",[s._v("数据表明很少人用到 DTrace、SystemTap 或 ETW，维护它们没有多大的意义。")]),s._v(" "),e("p",[s._v("如果你想恢复使用，可提 issues => https://github.com/nodejs/node/issues/44550")]),s._v(" "),e("h2",{attrs:{id:"_5-升级-v8-引擎至-10-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-升级-v8-引擎至-10-7"}},[s._v("#")]),s._v(" 5. 升级 V8 引擎至 10.7")]),s._v(" "),e("p",[s._v("Node.js v19 将 V8 JavaScript 引擎更新至 V8 10.7，其中包含一个新函数 Intl.NumberFormat，用于格式化敏感数字。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Intl.NumberFormat(locales, options)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("对于不同的语言，传入不同的 locales：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const number = 123456.789;\n\nconsole.log(new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(number));\nconsole.log(new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(number));\nconsole.log(new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'EGP' }).format(number));\nconsole.log(new Intl.NumberFormat('zh-CN', { style: 'currency', currency: 'CNY' }).format(number));\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"_6-试验-node-watch-模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-试验-node-watch-模式"}},[s._v("#")]),s._v(" 6. 试验 Node watch 模式")]),s._v(" "),e("p",[s._v("运行时增加了 node --watch 选项。")]),s._v(" "),e("p",[s._v('在 "watch" 模式下运行，当导入的文件被改变时，会重新启动进程。')]),s._v(" "),e("p",[s._v("比如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('const express = require("express");\nconst path = require("path");\nconst app = express();\napp.use(express.static(path.join(__dirname, "../build")));\n\napp.listen(8080, () =>\n  console.log("Express server is running on localhost:8080")\n);\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("% node --watch server\n(node:67643) ExperimentalWarning: Watch mode is an experimental feature. This feature could change at any time\n(Use `node --trace-warnings ...` to show where the warning was created)\nExpress server is running on localhost:8080\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("hr"),s._v(" "),e("p",[s._v("Node.js 14 将在 2023 年 4 月结束更新维护，Node.js 16 (LTS) 预计将在 2023 年 9 月结束更新维护。")]),s._v(" "),e("p",[s._v("建议大家开始计划将版本按需升级到 Node.js 16（LTS）或 Node.js 18（LTS）。")]),s._v(" "),e("p",[s._v("推荐阅读：")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://nodejs.org/en/blog/announcements/v19-release-announce/#node-watch-experimental",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node.js 19 is now available! | Node.js"),e("OutboundLink")],1)])]),s._v(" "),e("hr"),s._v(" "),e("blockquote",[e("p",[s._v("OK，以上便是本篇分享，希望各位工友喜欢~ 欢迎点赞、收藏、评论 🤟")]),s._v(" "),e("p",[s._v("我是掘金安东尼 🤠 100 万人气前端技术博主 💥 INFP 写作人格坚持 1000 日更文 ✍ 关注我，安东尼陪你一起度过漫长编程岁月 🌏")])]),s._v(" "),e("p",[e("em",[e("strong",[s._v("本文正在参加"),e("a",{attrs:{href:"https://juejin.cn/post/7162096952883019783",title:"https://juejin.cn/post/7162096952883019783",target:"_blank",rel:"noopener noreferrer"}},[s._v("「金石计划 . 瓜分6万现金大奖」"),e("OutboundLink")],1)])])])])}),[],!1,null,null,null);n.default=t.exports}}]);