(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{684:function(s,e,a){"use strict";a.r(e);var t=a(2),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("一起养成写作习惯！这是我参与「掘金日新计划 · 4 月更文挑战」的第5天，"),a("a",{attrs:{href:"https://juejin.cn/post/7080800226365145118",title:"https://juejin.cn/post/7080800226365145118",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击查看活动详情"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("闲言少叙，直接开冲！")]),s._v(" "),a("p",[s._v("先用 JS 原生写一个搜索功能：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<input id=\"text\"></input>\n<script>\n    var text = document.querySelector('#text');\n    text.addEventListener('keyup', (e) =>{\n        var searchText = e.target.value;\n        $.ajax({ // 发送请求\n            url: `search.qq.com/${searchText}`,\n            success: data => {\n              render(data); // 处理数据\n            }\n        });\n    });\n<\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("搜索都是要做防抖处理的，简易版防抖如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<input id=\"text\"></input>\n<script>\n    var text = document.querySelector('#text'),\n        timer = null;\n    text.addEventListener('keyup', (e) =>{\n        clearTimeout(timer); // 频繁触发则会清除上一定时器\n        timer = setTimeout(() => {\n            console.log('发起请求..');\n        },300) // 300 后毫秒触发；\n    })\n<\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("所以，搜索功能演变为：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<input id=\"text\"></input>\n<script>\n    var text = document.querySelector('#text'),\n        timer = null,\n        currentSearch = '';\n \n    text.addEventListener('keyup', (e) =>{\n        clearTimeout(timer)\n        timer = setTimeout(() => {\n            var searchText = e.target.value;\n            $.ajax({\n                url: `search.qq.com/${searchText}`,\n                success: data => {\n                    render(data);\n                }           \n            });\n        },300)\n    })\n<\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("对吧，很常规。但是实际上的业务往往会远大于示例中的代码，按照上面的思路，最终会写成这种玩意儿：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68da691aa3fc4a2c89d1cda8106254c3~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}}),s._v("\n一点不夸张。")]),s._v(" "),a("p",[s._v("这个时候，只能献祭出终极解决方案：本篇主角 —— RxJS 了，其实不止有 JS 的 RxJS，与之对应的还有，RxJava、RxAndroid、RxSwift，它们都是处理异步编程的【核武器库】；")]),s._v(" "),a("p",[s._v("RxJS 实现：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import { fromEvent } from 'rxjs';\nimport { debounceTime, pluck, switchMap } from 'rxjs/operators';\n\nvar text = document.querySelector('#text');\nvar inputStream = Rx.Observable.fromEvent(text, 'keyup')\n                    .debounceTime(300)\n                    .pluck('target', 'value')\n                    .switchMap(url => Http.get(url))\n                    .subscribe(data => render(data));\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("让我们来一一解析它的 API：")]),s._v(" "),a("ul",[a("li",[s._v("fromEvent")])]),s._v(" "),a("p",[s._v("fromEvent "),a("strong",[s._v("用于将事件转换成 observable 序列")]),s._v("（若还不理解什么是 observable 的同学，可以简单理解它为一个加强版本的 Promise）；")]),s._v(" "),a("p",[s._v("总之，创建点击时间的 observable 都这样写：")]),s._v(" "),a("p",[a("code",[s._v("const source = fromEvent(document, 'click');")])]),s._v(" "),a("ul",[a("li",[s._v("debounceTime")])]),s._v(" "),a("p",[s._v("这个好理解，对事件加防抖的，参数就是防抖时间；")]),s._v(" "),a("p",[s._v("官方解释就是："),a("strong",[a("strong",[s._v("舍弃掉在两次输出之间小于指定时间的发出值；")])])]),s._v(" "),a("p",[s._v("u1s1，这解释读起来很费劲。。（若还不理解什么是防抖的同学，可以将它理解为 LOL 中的回程，按下 B 键，隔了几秒，才会真正回城回血，如果一直按 B ，则一直不会回城）；")]),s._v(" "),a("ul",[a("li",[s._v("pluck")])]),s._v(" "),a("p",[a("strong",[a("strong",[s._v("选择属性来发出；")])])]),s._v(" "),a("p",[s._v("比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const source = from([{ name: 'Joe', age: 30 }, { name: 'Sarah', age: 35 }]);\n// 提取 name 属性\nconst example = source.pipe(pluck('name'));\n// 输出: \"Joe\", \"Sarah\"\nconst subscribe = example.subscribe(val => console.log(val));\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在搜索的例子中，则是提取点击的 "),a("code",[s._v("event.target.value")])]),s._v(" "),a("ul",[a("li",[s._v("switchMap")])]),s._v(" "),a("p",[s._v("switchMap 要重点理解下；")]),s._v(" "),a("p",[s._v("官方解释是："),a("strong",[a("strong",[s._v("映射成 observable，完成前一个内部 observable，发出值。")])])]),s._v(" "),a("p",[s._v("没错，依然不好懂 ZZZ")]),s._v(" "),a("p",[s._v("不如，换个角度来解释：")]),s._v(" "),a("p",[s._v("RxJS 中通常用【弹珠图】来表示“事件流”，比如 "),a("code",[s._v("map api")]),s._v(" 的弹珠图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/914a0ca9fbce49b3b96bd03a60dad0f2~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[a("code",[s._v("switch api")]),s._v(" 的弹珠图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/350bde83d6314848b74fba62ddd9548c~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("当发出一个新的内部 Observable 时， "),a("code",[s._v("switch")]),s._v(" 会从先前发送的内部 Observable 那取消订阅，然后订阅新的内部 Observable 并开始发出它的值。")]),s._v(" "),a("p",[s._v("即永远订阅最新的Observable；")]),s._v(" "),a("p",[a("strong",[s._v("那么：switchMap = map + switch ，示意如下：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc4cd690ea66493cb5428f2c2af24ef6~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),s._v(" "),a("p",[s._v("结合理解，在本篇搜索示例中，即用 Http.get(url) 所得 data 值作为事件流的最新值，进行后续的传递；")]),s._v(" "),a("p",[s._v("至此，我们可以得出：RxJS 让代码变得十分简洁、可读，前提是，我们熟悉事件流这个东西，熟悉它的 API~~")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("OK，以上便是本篇分享，希望对你能有所帮助~觉得不错，给个三连吧 👍👍👍")]),s._v(" "),a("blockquote",[a("p",[s._v("我是掘金安东尼，输出暴露输入，技术洞见生活。")])])])}),[],!1,null,null,null);e.default=n.exports}}]);