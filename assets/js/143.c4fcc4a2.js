(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{639:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("「这是我参与2022首次更文挑战的第5天，活动详情查看："),e("a",{attrs:{href:"https://juejin.cn/post/7052884569032392740",title:"https://juejin.cn/post/7052884569032392740",target:"_blank",rel:"noopener noreferrer"}},[s._v("2022首次更文挑战"),e("OutboundLink")],1),s._v("」")]),s._v(" "),e("p",[s._v("主体通译自 "),e("a",{attrs:{href:"https://medium.com/bitsrc/your-javascript-smells-3574121bcfbe",target:"_blank",rel:"noopener noreferrer"}},[s._v("your-javascript-smells"),e("OutboundLink")],1)]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("打开 IDE，来找一些有“异味”的代码，就像打开冰箱，找到一些发臭的食物，再将它们清理出去。虽然有“异味”的代码，不处理，也许没那么要紧，但是这种“异味”，是“糜烂”、进而影响整个冰箱食物的预警。")]),s._v(" "),e("p",[s._v("上代码：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('let a = "start";\nlet b;\n\nfor(let i = 0; i < 5; i++) {\n  b += a[i].toUpperCase();\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("会不会觉得有点味道？把每个字母编程大写，用另外一个值去承接，整个暂且不论，更扯的是循环的次数 5 是被写死的，这样没有任何可扩展可言。")]),s._v(" "),e("p",[s._v("先稍微把这点“异味”处理下先：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('let a = "start";\nlet b;\n\nfor(let i = 0; i < a.length; i++) {\n  b += a[i].toUpperCase()\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("然后尽量省去这个中间值，用函数封装一个通用方法；")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('let a=\'start\'\nlet upperCaseStrFn=(str)=>{\n    return str.split("").map(i=>i.toUpperCase()).join("")\n}\nconsole.log(upperCaseStrFn(a)) // START\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("这样，异味就被消除啦。")]),s._v(" "),e("p",[s._v("看到 "),e("code",[s._v("upperCaseStrFn")]),s._v("，不需要知道它内部的实现，就知道这个函数是把一个字符串每个字母变成大写的方法，这就是"),e("strong",[s._v("可读性")]),s._v("；同时，这个函数不止能处理 a 变量，还能处理其它变成，或者在函数内部再进行扩展，就是"),e("strong",[s._v("可扩展性")]),s._v("；")]),s._v(" "),e("p",[s._v("关于可读性的另外一个问题：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("let total_cost = order.getCost() * 1.52;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("看到这一行代码，噢，它是用来计算总数的，订单的花费，乘以 1.52...不对！这个 1.52 是什么？")]),s._v(" "),e("p",[s._v("解决异味：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const MADRID_TAX_RATE = 1.52;\n\nlet total_cost = order.getCost() * MADRID_TAX_RATE;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("噢噢，这个 1.52 是 MADRID 税率。")]),s._v(" "),e("p",[s._v("将数据声明和数据处理分开，就是低耦合、高内聚的代码，修改起来也方便，改一处，多处生效；")]),s._v(" "),e("p",[s._v("还有？")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Single-responsibility_principle",target:"_blank",rel:"noopener noreferrer"}},[s._v("单一职责原则"),e("OutboundLink")],1),s._v(" 可以有效去除“异味”。")]),s._v(" "),e("p",[s._v("把功能拆分成乐高积木，拆的越精细、紧凑，可组合的灵活性就越大。每个积木都有着单一的功能。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function saveUser(name: string, address: string, birthdate: Date, phone_number: string) {\n\t//...\n\tlet diff_ms = Date.now() - birthdate.getTime();\n\tlet age_dt = new Date(diff_ms);\n\tlet age: number = Math.abs(age_dt.getUTCFullYear() - 1970);\n\n\t///....\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("优化后：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function saveUser(usr: User) {                                                \n\t//...\n\tlet age: number = usr.getAge();\n\t//...\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("优化后的代码虽然没全部展示，但是关键部分更易读，不是吗？不需要知道 getAge() 的具体做了什么，只要知道它是做什么的就行。因为你的目光是聚焦在 saveUser() 这个方法上。")]),s._v(" "),e("p",[s._v("还有，常常会遇到这类代码：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function configureChristmasTreeLights(tree, mode) {\n  \n  switch(mode) {\n    'rgb_blinking': \n      tree.setColors('rgb', {\n        'blinking': true,\n        'frequency': 10\n      })\n      break;\n    'rgb_fixed':\n      tree.setColors('rgb', {\n        'blinking': false\n      })\n      break;\n    'white_smooth':\n      tree.setColor('white', {\n        'blinking': true,\n        'frequency': 1\n      })\n      break;\n    default:\n      throw new Error(\"Unrecognized mode used\")\n      break;\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("switch 函数体太大了，并且还有可能变得更大。所以，要消除这个“异味”：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/// Helper functions\nfunction blinkingRGBLights(tree) {\n  tree.setColor('rgb', {\n    'blinking': true,\n    'frequency': 10\n  })\n}\n\nfunction fixedRGBLights(tree){\n  tree.setColor('rgb', { 'blinking': false})\n}\n\nfunction whiteSmoothLights(tree) {\n  tree.setColor('white', {\n    'blinking': true,\n    'frequency': 1\n  })\n}\n\n//The actual function\nfunction configureChristmasTreeLights(tree, mode) {\n  const mapping = {\n    'rgb_blinking': blinkingRGBLights,\n    'rgb_fixed': fixedRGBLights,\n    'white_smooth': whiteSmoothLights\n  }\n  \n  try {\n    mapping[mode](tree);\n  } catch (e) {\n    throw new Error(\"Unrecognized mode used\")\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br")])]),e("p",[s._v("采用 map 的方式可以很好的处理多个判断条件的局面。本瓜对此点深有体会：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("if(x===a){\n   res=A\n}else if(x===b){\n   res=B\n}else if(x===c){\n   res=C\n}else if(x===d){\n    //...\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("改写为：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("let mapRes={\n    a:A,\n    b:B,\n    c:C,\n    //...\n}\nres=mapRes[x]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("还有：")]),s._v(" "),e("p",[s._v("重复的代码需要封装抽象，这会帮助你的同事，帮助他们用你的方法，是一种“善举”，其实就相当于在团队小范围内在造轮子造福大家了。")]),s._v(" "),e("p",[s._v("小感：")]),s._v(" "),e("p",[s._v("把数据声明和数据处理分离开来，真的很重要！！")]),s._v(" "),e("p",[s._v("让我们一起来为 JavaScript 消除异味吧~~")]),s._v(" "),e("blockquote",[e("p",[s._v("我是掘金安东尼，输出暴露输入，技术洞见生活，再会~")])])])}),[],!1,null,null,null);n.default=t.exports}}]);