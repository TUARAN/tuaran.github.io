(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{742:function(a,n,e){"use strict";e.r(n);var s=e(2),t=Object(s.a)({},(function(){var a=this,n=a.$createElement,e=a._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("携手创作，共同成长！这是我参与「掘金日新计划 · 8 月更文挑战」的第21天，"),e("a",{attrs:{href:"https://juejin.cn/post/7123120819437322247",title:"https://juejin.cn/post/7123120819437322247",target:"_blank",rel:"noopener noreferrer"}},[a._v("点击查看活动详情"),e("OutboundLink")],1)]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("减轻阅读负担，启发创作心智，轻松学习 JavaScript 技巧，日拱一卒，jym，冲~")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5baeb2f877364de68cd24b2c62fdca1f~tplv-k3u1fbpfcp-watermark.image?",alt:"take-it-easy-relax.gif"}})]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("map 大家都很熟悉了，WeakMap 听说过吗？听这个名字就很“弱”的，别误会，它不是“弱”，而是"),e("strong",[a._v("容易被清理")])]),a._v(" "),e("p",[a._v("举个栗子：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("let john = { name: \"John\" };\n\nlet array = [ john ];\n\njohn = null; // 覆盖引用\n\nconsole.log(array[0]) // {name: 'John'}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("p",[a._v("我们声明了一个 john 对象，然后在数组里面引用了它，然后再尝试清空它， "),e("code",[a._v("john = null")]),a._v("，然后再访问："),e("code",[a._v("array[0]")]),a._v("，结果发现，仍然能成功打印。")]),a._v(" "),e("p",[a._v("这说明 array 对 对象 john 的引用，导致内存无法正常清理。")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c79b4ae9e684d8898f75e87ddc67ecb~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),a._v(" "),e("p",[e("strong",[a._v("WeakMap 就是来解决这个问题的：")])]),a._v(" "),e("p",[a._v("对比 2 组代码，分别是 map 和 weakMap 在这个问题下的表现：")]),a._v(" "),e("ul",[e("li",[a._v("Map")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('let john = { name: "John" };\n\nlet map = new Map();\nmap.set(john, "...");\n\njohn = null; // 覆盖引用\n\nconsole.log(map.keys()) // 仍然能访问\n\n// john 被存储在了 map 中，\n// 我们仍可以使用 map.keys() 来获取它\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bca4f5254ff14d4c91bedaff97c33725~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),a._v(" "),e("ul",[e("li",[a._v("WeakMap")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('let john = { name: "John" };\n\nlet weakMap = new WeakMap();\n\nweakMap.set(john, "...");\n\njohn = null; // 覆盖引用\n\nconsole.log(weakMap.has(john))\n\n// john 被从内存中删除了！\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d1c3988b18341238f9d4b73109fabbc~tplv-k3u1fbpfcp-watermark.image?",alt:"image.png"}})]),a._v(" "),e("p",[a._v("WeakMap 中使用一个对象作为键，并且没有其他对这个对象的引用 —— 该对象将会被从内存（和map）中自动清除。")]),a._v(" "),e("ul",[e("li",[a._v("此外特别说明：WeakMap 和 Map 的很重要的不同点就是，WeakMap 的键必须是对象，不能是原始值。")])]),a._v(" "),e("p",[a._v("WeakMap 不支持迭代以及 keys()，values() 和 entries() 方法。所以没有办法获取 WeakMap 的所有键或值。")]),a._v(" "),e("p",[a._v("另外 WeakMap 只有以下的方法：weakMap.get(key)、weakMap.set(key, value)、weakMap.delete(key)、weakMap.has(key)")]),a._v(" "),e("p",[a._v("所以 WeakMap 的主要优点是它们对对象是弱引用，被它们引用的对象很容易地被垃圾收集器移除。但这是以不支持一些对象方法为代价换来的~")]),a._v(" "),e("p",[a._v("没有优劣之分，按需所取罢了~~")]),a._v(" "),e("blockquote",[e("p",[a._v("OK，以上便是本篇分享。点赞关注评论，为好文助力👍")]),a._v(" "),e("p",[a._v("我是掘金安东尼 🤠 100 万人气前端技术博主 💥 INFP 写作人格坚持 1000 日更文 ✍ 关注我，安东尼陪你一起度过漫长编程岁月 🌏")])])])}),[],!1,null,null,null);n.default=t.exports}}]);