(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{602:function(s,n,e){"use strict";e.r(n);var a=e(2),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("本瓜知道前不久写的《JS 如何函数式编程》系列各位可能并不感冒，因为一切理论的东西如果脱离实战的话，那就将毫无意义。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6cDpC.th.png",alt:"I6cDpC.th.png"}})]),s._v(" "),e("p",[s._v("于是乎，本瓜着手于实际工作开发，尝试应用函数式编程的一些思想。")]),s._v(" "),e("p",[s._v("最终惊人的发现："),e("strong",[s._v("这个实现过程并不难，但是效果却不小！")])]),s._v(" "),e("p",[s._v("实现思路：借助 compose 函数对连续的异步过程进行组装，不同的组合方式实现不同的业务流程。")]),s._v(" "),e("p",[s._v("这样不仅提高了代码的"),e("strong",[s._v("可读性")]),s._v("，还提高了代码的"),e("strong",[s._v("扩展性")]),s._v("。我想：这也许就是"),e("strong",[s._v("高内聚、低耦合")]),s._v("吧~")]),s._v(" "),e("p",[s._v("撰此篇记之，并与各位分享。")]),s._v(" "),e("h2",{attrs:{id:"场景说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#场景说明"}},[s._v("#")]),s._v(" 场景说明")]),s._v(" "),e("p",[s._v("在和产品第一次沟通了需求后，我理解需要实现一个应用 "),e("strong",[s._v("新建流程")]),s._v("，具体是这样的：")]),s._v(" "),e("p",[s._v("第 1 步：调用 sso 接口，拿到返回结果 res_token；")]),s._v(" "),e("p",[s._v("第 2 步：调用 create 接口，拿到返回结果 res_id；")]),s._v(" "),e("p",[s._v("第 3 步：处理字符串，拼接 Url；")]),s._v(" "),e("p",[s._v("第 4 步：建立 websocket 链接；")]),s._v(" "),e("p",[s._v("第 5 步：拿到 websocket 后端推送关键字，渲染页面；")]),s._v(" "),e("ul",[e("li",[s._v("注：接口、参数有做一定简化")])]),s._v(" "),e("p",[s._v("上面除了第 3 步、第 5 步，剩下的都是要调接口的，并且前后步骤都有传参的需要，可以理解为一个连续且有序的异步调用过程。")]),s._v(" "),e("p",[s._v("为了快速响应产品需求，于是本瓜迅速写出了以下代码：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * 新建流程\n * @param {*} appId\n * @param {*} tag\n */\n\nexport const handleGetIframeSrc = function(appId, tag) {\n  let h5Id\n// 第 1 步: 调用 sso 接口，获取token\n  getsingleSignOnToken({ formSource: tag }).then(data => { \n    return new Promise((resolve, reject) => {\n      resolve(data.result)\n    })\n  }).then(token => { \n    const para = { appId: appId }\n    return new Promise((resolve, reject) => {\n// 第 2 步: 调用 create 接口，新建应用\n      appH5create(para).then(res => {\n// 第 3 步: 处理字符串，拼接 Url\n        this.handleInsIframeUrl(res, token, appId)\n        this.setH5Id(res.result.h5Id)\n        h5Id = res.result.h5Id\n        resolve(h5Id)\n      }).catch(err => {\n        this.$message({\n          message: err.message || '出现错误',\n          type: 'error'\n        })\n      })\n    })\n  }).then(h5Id => { \n// 第 4 步：建立 websocket 链接；\n    return new Promise((resolve, reject) => {\n      webSocketInit(resolve, reject, h5Id)\n    })\n  }).then(doclose => {\n// 第 5 步：拿到 websocket 后端推送关键字，渲染页面；\n    if (doclose) { this.setShowEditLink({ appId: appId, h5Id: h5Id, state: true }) }\n  }).catch(err => {\n    this.$message({\n      message: err.message || '出现错误',\n      type: 'error'\n    })\n  })\n}\n\nconst handleInsIframeUrl = function(res, token, appId) { \n// url 拼接\n  const secretId = this.$store.state.userinfo.enterpriseList[0].secretId\n  let editUrl = res.result.editUrl\n  const infoId = editUrl.substr(editUrl.indexOf('?') + 1, editUrl.length - editUrl.indexOf('?'))\n  editUrl = res.result.editUrl.replace(infoId, `from=a2p&${infoId}`)\n  const headList = JSON.parse(JSON.stringify(this.headList))\n  headList.forEach(i => {\n    if (i.appId === appId) { i.srcUrl = `${editUrl}&token=${token}&secretId=${secretId}` }\n  })\n  this.setHeadList(headList)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br")])]),e("p",[s._v("这段代码是非常自然地根据产品所提需求，然后自己理解所编写。")]),s._v(" "),e("p",[s._v("其实还可以，是吧？🐶")]),s._v(" "),e("h2",{attrs:{id:"需求更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需求更新"}},[s._v("#")]),s._v(" 需求更新")]),s._v(" "),e("p",[s._v("但你不得不承认，程序员和产品之间有一条无法逾越的"),e("strong",[s._v("沟通鸿沟")]),s._v("。")]),s._v(" "),e("p",[s._v("它大部分是由所站角度不同而产生，只能说：李姐李姐！")]),s._v(" "),e("p",[s._v("所以，基于前一个场景，需求发生了点 "),e("strong",[s._v("更新")]),s._v(" ~")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6UGrz.th.png",alt:"I6UGrz.th.png"}})]),s._v(" "),e("p",[s._v("除了上节所提的 "),e("strong",[s._v("【新建流程】")]),s._v(" ，还要加一个 "),e("strong",[s._v("【编辑流程】")]),s._v(" ╮(╯▽╰)╭")]),s._v(" "),e("p",[s._v("编辑流程简单来说就是：砍掉新建流程的第 2 步调接口，再稍微调整传参即可。")]),s._v(" "),e("p",[s._v("于是本瓜直接 copy 一下再作简单删改，不到 1 分钟，编辑流程的代码就诞生了~")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * 编辑流程\n */\n \nconst handleToIframeEdit = function() { // 编辑 iframe\n  const { editUrl, appId, h5Id } = this.ruleForm\n// 第 1 步: 调用 sso 接口，获取token\n  getsingleSignOnToken({ formSource: 'ins' }).then(data => {\n    return new Promise((resolve, reject) => {\n      resolve(data.result)\n    })\n  }).then(token => { \n// 第 2 步：处理字符串，拼接 Url\n    return new Promise((resolve, reject) => {\n      const secretId = this.$store.state.userinfo.enterpriseList[0].secretId\n      const infoId = editUrl.substr(editUrl.indexOf('?') + 1, editUrl.length - editUrl.indexOf('?'))\n      const URL = editUrl.replace(infoId, `from=a2p&${infoId}`)\n      const headList = JSON.parse(JSON.stringify(this.headList))\n      headList.forEach(i => {\n        if (i.appId === appId) { i.srcUrl = `${URL}&token=${token}&secretId=${secretId}` }\n      })\n      this.setHeadList(headList)\n      this.setShowEditLink({ appId: appId, h5Id: h5Id, state: false })\n      this.setShowNavIframe({ appId: appId, state: true })\n      this.setNavLabel(this.headList.find(i => i.appId === appId).name)\n      resolve(h5Id)\n    })\n  }).then(h5Id => {\n// 第 3 步：建立 websocket 链接；\n    return new Promise((resolve, reject) => {\n      webSocketInit(resolve, reject, h5Id)\n    })\n  }).then(doclose => {\n// 第 4 步：拿到 websocket 后端推送关键字，渲染页面；\n    if (doclose) { this.setShowEditLink({ appId: appId, h5Id: h5Id, state: true }) }\n  }).catch(err => {\n    this.$message({\n      message: err.message || '出现错误',\n      type: 'error'\n    })\n  })\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br")])]),e("h2",{attrs:{id:"需求再更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需求再更新"}},[s._v("#")]),s._v(" 需求再更新")]),s._v(" "),e("p",[s._v("老实讲，不怪产品，咱做需求的过程也是逐步理解需求的过程。理解有变化，再正常不过！(#^.^#) 李姐李姐......")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6UIKu.th.png",alt:"I6UIKu.th.png"}})]),s._v(" "),e("p",[s._v("上面已有两个流程："),e("strong",[s._v("新建流程、编辑流程")]),s._v("。")]),s._v(" "),e("p",[s._v("这次，要再加一个 "),e("strong",[s._v("重新创建流程")]),s._v(" ~")]),s._v(" "),e("p",[s._v("重新创建流程可简单理解为：在新建流程之前调一个 delDraft 删除草稿接口；")]),s._v(" "),e("p",[s._v("至此，我们产生了三个流程：")]),s._v(" "),e("ol",[e("li",[s._v("新建流程；")]),s._v(" "),e("li",[s._v("编辑流程；")]),s._v(" "),e("li",[s._v("重新创建流程；")])]),s._v(" "),e("p",[s._v("本瓜这里作个简单的脑图示意逻辑：")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6Xi9Q.png",alt:"I6Xi9Q.png"}})]),s._v(" "),e("p",[s._v("我的直觉告诉我：不能再 copy 一份新建流程作修改了，因为这样就太拉了。。。没错，它没有耦合，但是它也没有内聚，这不是我想要的。于是，我开始封装了......")]),s._v(" "),e("p",[s._v("实现上述脑图的代码：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * 判断是否存在草稿记录？\n */\njudgeIfDraftExist(item) {\n  const para = { appId: item.appId }\n  return appH5ifDraftExist(para).then(res => {\n    const { editUrl, h5Id, version } = res.result\n    if (h5Id === -1) { // 不存在草稿\n      this.handleGetIframeSrc(item)\n    } else { // 存在草稿\n      this.handleExitDraft(item, h5Id, version, editUrl)\n    }\n  }).catch(err => {\n    console.log(err)\n  })\n},\n/**\n * 选择继续编辑？\n */\nhandleExitDraft(item, h5Id, version, editUrl) {\n  this.$confirm('有未完成的信息收集链接，是否继续编辑?', '提示', {\n    confirmButtonText: '继续编辑',\n    cancelButtonText: '重新创建',\n    type: 'warning'\n  }).then(() => {\n    const editUrlH5Id = h5Id\n    this.handleGetIframeSrc(item, editUrl, editUrlH5Id)\n  }).catch(() => {\n    this.handleGetIframeSrc(item)\n    appH5delete({ h5Id: h5Id, version: version })\n  })\n},\n/**\n * 新建流程、编辑流程、重新创建流程；\n */\nhandleGetIframeSrc(item, editUrl, editUrlH5Id) {\n  let ws_h5Id\n  getsingleSignOnToken({ formSource: item.tag }).then(data => { \n// 调用 sso 接口，拿到返回结果 res_token；\n    return new Promise((resolve, reject) => {\n      resolve(data.result)\n    })\n  }).then(token => {\n    const para = { appId: item.appId }\n    return new Promise((resolve, reject) => {\n      if (!editUrl) { // 新建流程、重新创建流程\n// 调用 create 接口，拿到返回结果 res_id；\n        appH5create(para).then(res => {\n// 处理字符串，拼接 Url；\n          this.handleInsIframeUrl(res.result.editUrl, token, item.appId)\n          this.setH5Id(res.result.h5Id)\n          ws_h5Id = res.result.h5Id\n          this.setShowNavIframe({ appId: item.appId, state: true })\n          this.setNavLabel(item.name)\n          resolve(true)\n        }).catch(err => {\n          this.$message({\n            message: err.message || '出现错误',\n            type: 'error'\n          })\n        })\n      } else { // 编辑流程\n        this.handleInsIframeUrl(editUrl, token, item.appId)\n        this.setH5Id(editUrlH5Id)\n        ws_h5Id = editUrlH5Id\n        this.setShowNavIframe({ appId: item.appId, state: true })\n        this.setNavLabel(item.name)\n        resolve(true)\n      }\n    })\n  }).then(() => { \n// 建立 websocket 链接；\n    return new Promise((resolve, reject) => {\n      webSocketInit(resolve, reject, ws_h5Id)\n    })\n  }).then(doclose => {\n// 拿到 websocket 后端推送关键字，渲染页面；\n    if (doclose) { this.setShowEditLink({ appId: item.appId, h5Id: ws_h5Id, state: true }) }\n  }).catch(err => {\n    this.$message({\n      message: err.message || '出现错误',\n      type: 'error'\n    })\n  })\n},\n\nhandleInsIframeUrl(editUrl, token, appId) {\n// url 拼接\n  const secretId = this.$store.state.userinfo.enterpriseList[0].secretId\n  const infoId = editUrl.substr(editUrl.indexOf('?') + 1, editUrl.length - editUrl.indexOf('?'))\n  const url = editUrl.replace(infoId, `from=a2p&${infoId}`)\n  const headList = JSON.parse(JSON.stringify(this.headList))\n  headList.forEach(i => {\n    if (i.appId === appId) { i.srcUrl = `${url}&token=${token}&secretId=${secretId}` }\n  })\n  this.setHeadList(headList)\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br")])]),e("p",[s._v("如此，我们便将 "),e("strong",[s._v("新建流程、编辑流程、重新创建流程")]),s._v(" 全部整合到了上述代码；")]),s._v(" "),e("h2",{attrs:{id:"需求再再更新"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需求再再更新"}},[s._v("#")]),s._v(" 需求再再更新")]),s._v(" "),e("p",[s._v("上面的封装看起来似乎还不错，但是这时我害怕了！想到：如果这个时候，"),e("strong",[s._v("还要加流程或者改流程呢？？？")]),s._v(" 我是打算继续用 if...else 叠加在那个主函数里面吗？还是打算直接 copy 一份再作删改？")]),s._v(" "),e("p",[s._v("我都能遇见它会充斥着各种判断，变量赋值、引用飞来飞去，最终成为一坨💩，没错，代码屎山的💩")]),s._v(" "),e("p",[s._v("我摸了摸左胸的左心房，它告诉我："),e("strong",[s._v("“饶了接盘侠吧~”")])]),s._v(" "),e("p",[s._v("于是乎，本瓜尝试引进了之前吹那么 nb 的函数式编程！它的能力就是"),e("strong",[s._v("让代码更可读")]),s._v("，这是我所需要的！来吧！！展示！！")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6cPMf.png",alt:"I6cPMf.png"}})]),s._v(" "),e("h2",{attrs:{id:"compose-函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compose-函数"}},[s._v("#")]),s._v(" compose 函数")]),s._v(" "),e("p",[s._v("我们在 "),e("a",{attrs:{href:"https://juejin.cn/post/6971260867300032525",target:"_blank",rel:"noopener noreferrer"}},[s._v("《XDM，JS如何函数式编程？看这就够了！（三）》"),e("OutboundLink")],1),s._v(" 这篇讲过函数组合 compose！没错，我们这次就要用到这个家伙！")]),s._v(" "),e("p",[s._v("还记得那句话吗?")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("组合 ———— 声明式数据流 ———— 是支撑函数式编程最重要的工具之一！")])])]),s._v(" "),e("p",[s._v("最基础的 compose 函数是这样的：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("function compose(...fns) {\n    return function composed(result){\n        // 拷贝一份保存函数的数组\n        var list = fns.slice();\n        while (list.length > 0) {\n            // 将最后一个函数从列表尾部拿出\n            // 并执行它\n            result = list.pop()( result );\n        }\n        return result;\n    };\n}\n\n// ES6 箭头函数形式写法\nvar compose =\n    (...fns) =>\n        result => {\n            var list = fns.slice();\n            while (list.length > 0) {\n                // 将最后一个函数从列表尾部拿出\n                // 并执行它\n                result = list.pop()( result );\n            }\n            return result;\n        };\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[s._v("它能将一个函数调用的输出路由跳转到另一个函数的调用上，然后一直进行下去。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6c6uy.png",alt:"I6c6uy.png"}})]),s._v(" "),e("p",[s._v("我们不需关注黑盒子里面做了什么，只需关注：这个东西（函数）是什么！它需要我输入什么！它的输出又是什么！")]),s._v(" "),e("h2",{attrs:{id:"composepromise"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#composepromise"}},[s._v("#")]),s._v(" composePromise")]),s._v(" "),e("p",[s._v("但上面提到的 compose 函数是组合同步操作，而在本篇的实战中，我们需要组合是异步函数！")]),s._v(" "),e("p",[s._v("于是它被改造成这样：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * @param  {...any} args\n * @returns\n */\n\nexport const composePromise = function(...args) {\n  const init = args.pop()\n  return function(...arg) {\n    return args.reverse().reduce(function(sequence, func) {\n      return sequence.then(function(result) {\n        // eslint-disable-next-line no-useless-call\n        return func.call(null, result)\n      })\n    }, Promise.resolve(init.apply(null, arg)))\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("原理："),e("strong",[s._v("Promise 可以指定一个 sequence，来规定一个执行 then 的过程，then 函数会等到执行完成后，再执行下一个 then 的处理。启动sequence 可以使用 Promise.resolve() 这个函数。构建 sequence 可以使用 reduce 。")])]),s._v(" "),e("p",[s._v("我们再写一个小测试在控制台跑一下！")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("let compose = function(...args) {\n  const init = args.pop()\n  return function(...arg) {\n    return args.reverse().reduce(function(sequence, func) {\n      return sequence.then(function(result) {\n        return func.call(null, result)\n      })\n    }, Promise.resolve(init.apply(null, arg)))\n  }\n}\n\nlet a = async() => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      console.log('xhr1')\n      resolve('xhr1')\n    }, 5000)\n  })\n}\n\nlet b = async() => {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      console.log('xhr2')\n      resolve('xhr2')\n    }, 3000)\n  })\n}\nlet steps = [a, b] // 从右向左执行\nlet composeFn = compose(...steps)\n\ncomposeFn().then(res => { console.log(666) })\n\n// xhr2\n// xhr1\n// 666\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("p",[s._v('它会先执行 b ，3 秒后输出 "xhr2"，再执行 a，5 秒后输出 "xhr1"，最后输出 666')]),s._v(" "),e("p",[s._v("你也可以在控制台带参 debugger 试试，很有意思：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("composeFn(1, 2).then(res => { console.log(66) })\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"逐渐美丽起来"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#逐渐美丽起来"}},[s._v("#")]),s._v(" 逐渐美丽起来")]),s._v(" "),e("p",[s._v("测试通过！借助上面 composePromise 函数，我们更加有信心用函数式编程 composePromise "),e("strong",[s._v("重构")]),s._v(" 我们的代码了。")]),s._v(" "),e("ul",[e("li",[s._v("实际上，这个过程一点不费力~")])]),s._v(" "),e("p",[s._v("实现如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n * 判断是否存在草稿记录？\n */\nhandleJudgeIfDraftExist(item) {\n    return appH5ifDraftExist({ appId: item.appId }).then(res => {\n      const { editUrl, h5Id, version } = res.result\n      h5Id === -1 ? this.compose_newAppIframe(item) : this.hasDraftConfirm(item, h5Id, editUrl, version)\n    }).catch(err => {\n      console.log(err)\n    })\n},\n/**\n * 选择继续编辑？\n */\nhasDraftConfirm(item, h5Id, editUrl, version) {\n    this.$confirm('有未完成的信息收集链接，是否继续编辑?', '提示', {\n      confirmButtonText: '继续编辑',\n      cancelButtonText: '重新创建',\n      type: 'warning'\n    }).then(() => {\n      this.compose_editAppIframe(item, h5Id, editUrl)\n    }).catch(() => {\n      this.compose_reNewAppIframe(item, h5Id, version)\n    })\n},\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("p",[e("strong",[s._v("敲黑板啦！画重点啦!")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n* 新建应用流程\n* 入参: item\n* 输出：item\n*/\ncompose_newAppIframe(...args) {\n    const steps = [this.step_getDoclose, this.step_createWs, this.step_splitUrl, this.step_appH5create, this.step_getsingleSignOnToken]\n    const handleCompose = composePromise(...steps)\n    handleCompose(...args)\n},\n/**\n* 编辑应用流程\n* 入参: item, draftH5Id, editUrl\n* 输出：item\n*/\ncompose_editAppIframe(...args) {\n    const steps = [this.step_getDoclose, this.step_createWs, this.step_splitUrl, this.step_getsingleSignOnToken]\n    const handleCompose = composePromise(...steps)\n    handleCompose(...args)\n},\n/**\n* 重新创建流程\n* 入参: item，draftH5Id，version\n* 输出：item\n*/\ncompose_reNewAppIframe(...args) {\n    const steps = [this.step_getDoclose, this.step_createWs, this.step_splitUrl, this.step_appH5create, this.step_getsingleSignOnToken, this.step_delDraftH5Id]\n    const handleCompose = composePromise(...steps)\n    handleCompose(...args)\n},\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("p",[e("strong",[s._v("我们通过 composePromise 执行不同的 steps，来依次执行（从右至左）里面的功能函数；你可以任意组合、增删或修改 steps 的子项，也可以任意组合出新的流程来应付产品。并且，它们都被封装在 compose_xxx 里面，相互独立，不会干扰外界其它流程。同时，传参也是非常清晰的，输入是什么！输出又是什么！一目了然！")])]),s._v(" "),e("p",[s._v("对照脑图再看此段代码，不正是对我们需求实现的最好诠释吗？")]),s._v(" "),e("p",[e("strong",[s._v("对于一个阅读陌生代码的人来说，你得先告诉他逻辑是怎样的，然后再告诉他每个步骤的内部具体实现。这样才是合理的！")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6Xi9Q.png",alt:"I6Xi9Q.png"}})]),s._v(" "),e("p",[s._v("功能函数（具体步骤内部实现）：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/**\n* 调用 sso 接口，拿到返回结果 res_token；\n*/\nstep_getsingleSignOnToken(...args) {\n    const [item] = args.flat(Infinity)\n    return new Promise((resolve, reject) => {\n      getsingleSignOnToken({ formSource: item.tag }).then(data => {\n        resolve([...args, data.result]) // data.result 即 token\n      })\n    })\n},\n/**\n*  调用 create 接口，拿到返回结果 res_id；\n*/\nstep_appH5create(...args) {\n    const [item, token] = args.flat(Infinity)\n    return new Promise((resolve, reject) => {\n      appH5create({ appId: item.appId }).then(data => {\n        resolve([item, data.result.h5Id, data.result.editUrl, token])\n      }).catch(err => {\n        this.$message({\n          message: err.message || '出现错误',\n          type: 'error'\n        })\n      })\n    })\n},\n/**\n* 调 delDraft 删除接口；\n*/\nstep_delDraftH5Id(...args) {\n    const [item, h5Id, version] = args.flat(Infinity)\n    return new Promise((resolve, reject) => {\n      appH5delete({ h5Id: h5Id, version: version }).then(data => {\n        resolve(...args)\n      })\n    })\n},\n/**\n*  处理字符串，拼接 Url；\n*/\nstep_splitUrl(...args) {\n    const [item, h5Id, editUrl, token] = args.flat(Infinity)\n    const infoId = editUrl.substr(editUrl.indexOf('?') + 1, editUrl.length - editUrl.indexOf('?'))\n    const url = editUrl.replace(infoId, `from=a2p&${infoId}`)\n    const headList = JSON.parse(JSON.stringify(this.headList))\n    headList.forEach(i => {\n      if (i.appId === item.appId) { i.srcUrl = `${url}&token=${token}` }\n    })\n    this.setHeadList(headList)\n    this.setH5Id(h5Id)\n    this.setShowNavIframe({ appId: item.appId, state: true })\n    this.setNavLabel(item.name)\n    return [...args]\n},\n/**\n*  建立 websocket 链接；\n*/\nstep_createWs(...args) {\n    return new Promise((resolve, reject) => {\n      webSocketInit(resolve, reject, ...args) \n})\n  },\n/**\n*  拿到 websocket 后端推送关键字，渲染页面；\n*/\nstep_getDoclose(...args) {\n    const [item, h5Id, editUrl, token, doclose] = args.flat(Infinity)\n    if (doclose) { this.setShowEditLink({ appId: item.appId, h5Id: h5Id, state: true }) }\n    return new Promise((resolve, reject) => {\n      resolve(true)\n    })\n},\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br")])]),e("p",[s._v("功能函数的输入、输出也是清晰可见的。")]),s._v(" "),e("p",[s._v("至此，我们可以认为：借助 compose 函数，借助函数式编程，咱把业务需求流程进行了封装，明确了输入输出，让我们的代码更加可读了！可扩展性也更高了！这不就是高内聚、低耦合？！")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://s3.jpg.cm/2021/07/24/I6UWZD.th.png",alt:"I6UWZD.th.png"}})]),s._v(" "),e("h2",{attrs:{id:"阶段总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#阶段总结"}},[s._v("#")]),s._v(" 阶段总结")]),s._v(" "),e("p",[e("strong",[s._v("你问我什么是 JS 函数式编程实战？我只能说本篇完全就是出自工作中的实战！！！")])]),s._v(" "),e("p",[e("strong",[s._v("这样导致本篇代码量可能有点多，但是这就是实打实的需求变化，代码迭代、改造的过程。（建议通篇把握、理解）")])]),s._v(" "),e("p",[s._v("当然，这不是终点，代码重构这个过程应该是每时每刻都在进行着。")]),s._v(" "),e("p",[s._v("对于函数式编程，简单应用 compose 函数，这也只是一个起点！")]),s._v(" "),e("p",[s._v("已经讲过，偏函数、函数柯里化、函数组合、数组操作、时间状态、函数式编程库等等概念......我们将再接再厉得使用它们，把代码屎山进行分类、打包、清理！让它不断美丽起来！💩 => 👩‍🦰")]),s._v(" "),e("p",[s._v("以上，便是本次分享~ 都看到这里，不如点个赞吧👍👍👍")]),s._v(" "),e("p",[s._v("谢谢支持~")]),s._v(" "),e("blockquote",[e("p",[s._v("我是掘金安东尼，输出暴露输入，技术洞见生活！下次再会~")])])])}),[],!1,null,null,null);n.default=t.exports}}]);